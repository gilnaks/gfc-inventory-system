(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4322:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,a.Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},4264:function(e,t,r){Promise.resolve().then(r.bind(r,3581))},3581:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return DashboardPage}});var a=r(7437),n=r(2265),s=r(2899);function BrandSelector(e){let{onBrandChange:t}=e,[r,i]=(0,n.useState)([]),[l,o]=(0,n.useState)(null),[d,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{fetchBrands()},[]);let fetchBrands=async()=>{try{console.log("Fetching brands from Supabase...");let{data:e,error:r}=await s.O.from("brands").select("*").order("name");if(console.log("Supabase response:",{data:e,error:r}),r){console.error("Error fetching brands:",r);return}e&&(console.log("Brands loaded:",e),i(e),e.length>0&&(o(e[0]),t(e[0])))}catch(e){console.error("Error fetching brands:",e)}finally{c(!1)}},handleBrandChange=e=>{let a=r.find(t=>t.id===e);a&&(o(a),t(a))};return d?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"text-gray-600",children:"Loading brands..."})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("label",{htmlFor:"brand-select",className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Brand:"}),(0,a.jsx)("select",{id:"brand-select",value:(null==l?void 0:l.id)||"",onChange:e=>handleBrandChange(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 text-sm min-w-[140px]",children:r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]})}var i=r(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,i.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var o=r(9883),d=r(2549);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,i.Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),x=(0,i.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),m=(0,i.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var u=r(8939);function ProductManager(e){let{selectedBrand:t,theme:r="blue"}=e,[i,p]=(0,n.useState)([]),[g,h]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),[f,v]=(0,n.useState)(null),[j,w]=(0,n.useState)({name:"",sku:"",category:"",unit:"pcs",price:0,initial_stock:0,production:0,released:0,reserved:0}),[N,k]=(0,n.useState)([]),[_,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&fetchProducts()},[t]),(0,n.useEffect)(()=>{if(!t)return;let e=s.O.channel("products-changes").on("postgres_changes",{event:"*",schema:"public",table:"products",filter:"brand_id=eq.".concat(t.id)},e=>{console.log("Products realtime update:",e),f?console.log("Skipping realtime refetch - currently editing product"):fetchProducts()}).subscribe();return()=>{s.O.removeChannel(e)}},[t,f]),(0,n.useEffect)(()=>{let e=Array.from(new Set(i.map(e=>e.category).filter(e=>e&&""!==e.trim()))).sort();k(e)},[i]),(0,n.useEffect)(()=>{let handleClickOutside=e=>{let t=e.target;_&&!t.closest(".category-dropdown")&&S(!1)};if(_)return document.addEventListener("mousedown",handleClickOutside),()=>document.removeEventListener("mousedown",handleClickOutside)},[_]);let getBrandPrefix=e=>{switch(e){case"gelatofilipino":return"GF-";case"mychoice":return"MC-";case"mang-sorbetes":return"MS-";default:return"PR-"}},generateNextSKU=async e=>{if(!t)return"";try{let{data:r,error:a}=await s.O.from("products").select("sku").eq("brand_id",e).not("sku","is",null);if(a)return console.error("Error fetching products for SKU generation:",a),getBrandPrefix(t.slug)+"001";let n=getBrandPrefix(t.slug),i=0;r&&r.length>0&&r.forEach(e=>{if(e.sku&&e.sku.startsWith(n)){let t=e.sku.substring(n.length),r=parseInt(t);!isNaN(r)&&r>i&&(i=r)}});let l=i+1;return n+l.toString().padStart(3,"0")}catch(e){return console.error("Error generating SKU:",e),getBrandPrefix(t.slug)+"001"}},fetchProducts=async()=>{if(t){h(!0);try{let{data:e,error:r}=await s.O.from("inventory_summary").select("*").eq("brand_id",t.id).order("product_name");if(r){console.error("Error fetching products:",r);return}e&&p(e)}catch(e){console.error("Error fetching products:",e)}finally{h(!1)}}},handleAddProduct=async e=>{if(e.preventDefault(),t)try{let{data:e,error:r}=await s.O.from("products").insert([{brand_id:t.id,name:j.name,sku:j.sku||null,category:j.category||null,unit:j.unit,price:j.price,initial_stock:j.initial_stock,production:j.production,released:j.released,reserved:j.reserved}]).select();if(r){console.error("Error adding product:",r),alert("Error adding product: "+r.message);return}e&&(await fetchProducts(),w({name:"",sku:"",category:"",unit:"pcs",price:0,initial_stock:0,production:0,released:0,reserved:0}),b(!1))}catch(e){console.error("Error adding product:",e),alert("Error adding product")}},handleUpdateProduct=async e=>{try{let{data:t,error:r}=await s.O.from("products").update({name:e.name,sku:e.sku,category:e.category,unit:e.unit,price:e.price,initial_stock:e.initial_stock,production:e.production,released:e.released,reserved:e.reserved}).eq("id",e.id).select();if(r){console.error("Error updating product:",r),alert("Error updating product: "+r.message);return}t&&(await fetchProducts(),v(null))}catch(e){console.error("Error updating product:",e),alert("Error updating product")}},handleDeleteProduct=async e=>{if(confirm("Are you sure you want to delete this product?"))try{let{error:t}=await s.O.from("products").delete().eq("id",e);if(t){console.error("Error deleting product:",t),alert("Error deleting product: "+t.message);return}console.log("Product deleted successfully"),p(i.filter(t=>(t.product_id||t.id)!==e)),setTimeout(async()=>{console.log("Refetching products to ensure consistency"),await fetchProducts()},500)}catch(e){console.error("Error deleting product:",e),alert("Error deleting product")}},handleFinalizeStock=async()=>{if(!t)return;let e=prompt("Please enter Wendy's birthdate to finalize stock:");if("030199"!==e){alert("Invalid birthdate. Stock finalization cancelled.");return}if(confirm("Are you sure you want to finalize the stock? This will move final stock to initial stock and clear production/released quantities for all products."))try{let{data:e,error:r}=await s.O.from("products").select("*").eq("brand_id",t.id);if(r){console.error("Error fetching products:",r),alert("Error fetching products for finalization");return}if(!e||0===e.length){alert("No products found to finalize");return}let{data:a,error:n}=await s.O.from("daily_stock_summaries").insert({brand_id:t.id,date:(0,u.sn)(),total_production:e.reduce((e,t)=>e+(t.production||0),0),total_released:e.reduce((e,t)=>e+(t.released||0),0),total_final_stock:e.reduce((e,t)=>e+(t.initial_stock||0)+(t.production||0)-(t.released||0),0)}).select().single();if(n){console.error("Error creating daily summary:",n),alert("Error creating daily summary");return}for(let t of e){let e=(t.initial_stock||0)+(t.production||0)-(t.released||0),{error:r}=await s.O.from("products").update({initial_stock:e,production:0,released:0,updated_at:new Date().toISOString()}).eq("id",t.id);if(r){console.error("Error updating product ".concat(t.name,":"),r),alert("Error updating product ".concat(t.name));return}}alert("Stock finalized successfully! All products have been updated for the next day."),await fetchProducts()}catch(e){console.error("Error finalizing stock:",e),alert("Error finalizing stock")}};return t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Products for ",t.name]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:handleFinalizeStock,className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors ".concat("bg-orange-600 hover:bg-orange-700"),children:[(0,a.jsx)(l,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Finalize Stock"})]}),(0,a.jsxs)("button",{onClick:async()=>{let e=await generateNextSKU(t.id);w({...j,sku:e}),b(!0)},className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors ".concat("green"===r?"bg-green-600 hover:bg-green-700":"red"===r?"bg-red-600 hover:bg-red-700":"yellow"===r?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Add Product"})]})]})]}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Product"}),(0,a.jsx)("button",{onClick:()=>{b(!1),w({name:"",sku:"",category:"",unit:"pcs",price:0,initial_stock:0,production:0,released:0,reserved:0})},className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-6 w-6"})})]}),(0,a.jsxs)("form",{onSubmit:handleAddProduct,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name *"}),(0,a.jsx)("input",{type:"text",required:!0,value:j.name,onChange:e=>w({...j,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter product name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU (Auto-generated)"}),(0,a.jsx)("input",{type:"text",value:j.sku,onChange:e=>w({...j,sku:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50",placeholder:"Auto-generated SKU"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["SKU format: ",getBrandPrefix(t.slug),"XXX (e.g., ",getBrandPrefix(t.slug),"001)"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,a.jsxs)("div",{className:"relative category-dropdown",children:[(0,a.jsx)("input",{type:"text",value:j.category,onChange:e=>{w({...j,category:e.target.value}),S(!0)},onFocus:()=>S(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter or select category"}),_&&N.length>0&&(0,a.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-40 overflow-y-auto",children:N.map(e=>(0,a.jsx)("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),w({...j,category:e}),S(!1)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Stock"}),(0,a.jsx)("input",{type:"number",min:"0",value:j.initial_stock,onChange:e=>w({...j,initial_stock:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),(0,a.jsxs)("select",{value:j.unit,onChange:e=>w({...j,unit:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"pans",children:"Pans"}),(0,a.jsx)("option",{value:"pcs",children:"Pieces"}),(0,a.jsx)("option",{value:"gallons",children:"Gallons"}),(0,a.jsx)("option",{value:"liters",children:"Liters"}),(0,a.jsx)("option",{value:"kg",children:"Kilograms"}),(0,a.jsx)("option",{value:"boxes",children:"Boxes"}),(0,a.jsx)("option",{value:"bags",children:"Bags"}),(0,a.jsx)("option",{value:"g",children:"Grams"}),(0,a.jsx)("option",{value:"bottles",children:"Bottles"}),(0,a.jsx)("option",{value:"packs",children:"Packs"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price (₱)"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:j.price,onChange:e=>w({...j,price:parseFloat(e.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{b(!1),w({name:"",sku:"",category:"",unit:"pcs",price:0,initial_stock:0,production:0,released:0,reserved:0})},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors ".concat("green"===r?"bg-green-600 hover:bg-green-700":"red"===r?"bg-red-600 hover:bg-red-700":"yellow"===r?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(c,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Save Product"})]})]})]})]})}),g?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading products..."})]}):0===i.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsxs)("p",{children:["No products found for ",t.name]}),(0,a.jsx)("p",{className:"text-sm",children:'Click "Add Product" to create your first product'})]}):(0,a.jsx)("div",{className:"space-y-6",children:(e=>{let t=e.reduce((e,t)=>{let r=t.category||"Uncategorized";return e[r]||(e[r]=[]),e[r].push(t),e},{}),r=Object.keys(t).sort((e,t)=>"Uncategorized"===e?1:"Uncategorized"===t?-1:e.localeCompare(t));return r.map(e=>({category:e,products:t[e]}))})(i).map(e=>{let{category:t,products:n}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-200 ease-in-out",children:[(0,a.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-b hover:bg-gray-100 transition-colors duration-200 ease-in-out",children:(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[t," (",n.length," ",1===n.length?"product":"products",")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48",children:"Product Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"SKU"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Unit"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Price"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Initial Stock"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Prod"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Rel"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Final Stock"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Res"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Available"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-blue-100",children:[(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"text",value:f.name,onChange:e=>v({...f,name:e.target.value}),className:"w-full max-w-44 px-2 py-1 border border-gray-300 rounded text-sm"}):e.product_name||e.name}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"text",value:f.sku||"",onChange:e=>v({...f,sku:e.target.value}),className:"w-full max-w-28 px-2 py-1 border border-gray-300 rounded text-sm"}):e.sku||"-"}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsxs)("select",{value:f.unit,onChange:e=>v({...f,unit:e.target.value}),className:"w-full max-w-20 px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,a.jsx)("option",{value:"pans",children:"Pans"}),(0,a.jsx)("option",{value:"pcs",children:"Pieces"}),(0,a.jsx)("option",{value:"gallons",children:"Gallons"}),(0,a.jsx)("option",{value:"liters",children:"Liters"}),(0,a.jsx)("option",{value:"kg",children:"Kilograms"}),(0,a.jsx)("option",{value:"boxes",children:"Boxes"}),(0,a.jsx)("option",{value:"bags",children:"Bags"}),(0,a.jsx)("option",{value:"g",children:"Grams"}),(0,a.jsx)("option",{value:"bottles",children:"Bottles"}),(0,a.jsx)("option",{value:"packs",children:"Packs"})]}):e.unit}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-green-600",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:f.price||0,onChange:e=>v({...f,price:parseFloat(e.target.value)||0}),className:"w-full max-w-20 px-2 py-1 border border-gray-300 rounded text-sm text-center [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}):"₱".concat((e.price||0).toFixed(2))}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"number",min:"0",value:f.initial_stock||0,onChange:e=>v({...f,initial_stock:parseInt(e.target.value)||0}),className:"w-full max-w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}):e.initial_stock||0}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"number",min:"0",value:f.production||0,onChange:e=>v({...f,production:parseInt(e.target.value)||0}),className:"w-full max-w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}):e.production||0}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"number",min:"0",value:f.released||0,onChange:e=>v({...f,released:parseInt(e.target.value)||0}),className:"w-full max-w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}):e.released||0}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-semibold text-purple-600",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(f.initial_stock||0)+(f.production||0)-(f.released||0):e.final_stock||0}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsx)("input",{type:"number",min:"0",value:f.reserved||0,onChange:e=>v({...f,reserved:parseInt(e.target.value)||0}),className:"w-full max-w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}):e.reserved||0}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-semibold text-emerald-600",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(f.initial_stock||0)+(f.production||0)-(f.released||0)-(f.reserved||0):e.available_stock||0}),(0,a.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("div",{className:"flex space-x-2",children:(null==f?void 0:f.id)===(e.product_id||e.id)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>handleUpdateProduct(f),className:"p-1 rounded ".concat("green"===r?"text-green-600 hover:text-green-900 hover:bg-green-100":"red"===r?"text-red-600 hover:text-red-900 hover:bg-red-100":"yellow"===r?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-100":"text-blue-600 hover:text-blue-900 hover:bg-blue-100"),title:"Save",children:(0,a.jsx)(c,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>v(null),className:"p-1 rounded text-gray-600 hover:text-gray-900 hover:bg-gray-200",title:"Cancel",children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>v({...e,id:e.product_id||e.id,name:e.product_name||e.name}),className:"p-1 rounded ".concat("green"===r?"text-green-600 hover:text-green-900 hover:bg-green-100":"red"===r?"text-red-600 hover:text-red-900 hover:bg-red-100":"yellow"===r?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-100":"text-blue-600 hover:text-blue-900 hover:bg-blue-100"),title:"Edit",children:(0,a.jsx)(x,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handleDeleteProduct(e.product_id||e.id),className:"p-1 rounded text-red-600 hover:text-red-900 hover:bg-red-100",title:"Delete",children:(0,a.jsx)(m,{className:"h-4 w-4"})})]})})})]},e.product_id||e.id))})]})})]},t)})})]}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,a.jsx)("p",{children:"Please select a brand to manage products"})})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,i.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),g=(0,i.Z)("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]),h=(0,i.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var y=r(3505);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let b=(0,i.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var f=r(8501);function OrderManager(e){var t;let{selectedBrand:r,onOrderUpdate:i,theme:o="blue"}=e,[d,c]=(0,n.useState)([]),[v,j]=(0,n.useState)(!1),[w,N]=(0,n.useState)(null),[k,_]=(0,n.useState)(null),[S,D]=(0,n.useState)("all"),[P,C]=(0,n.useState)(!1),[O,F]=(0,n.useState)(null),[A,E]=(0,n.useState)(null),[q,L]=(0,n.useState)([]),[z,T]=(0,n.useState)(!1);(0,n.useEffect)(()=>{fetchOrders()},[S,r]),(0,n.useEffect)(()=>{if(!r)return;let e=s.O.channel("customer-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"customer_orders",filter:"brand_id=eq.".concat(r.id)},e=>{console.log("Customer orders realtime update:",e),w?console.log("Skipping realtime refetch - currently updating order"):fetchOrders()}).subscribe();return()=>{s.O.removeChannel(e)}},[r,w]);let fetchOrders=async()=>{j(!0);try{let e=s.O.from("customer_orders").select("\n          *,\n          location:locations(*),\n          brand:brands(*),\n          order_details(\n            *,\n            product:products(id, name, sku, unit, category)\n          ),\n          logistics_assignments(\n            id,\n            date,\n            time_slot,\n            status\n          )\n        ").order("created_at",{ascending:!1});"all"!==S&&(e=e.eq("status",S)),r&&(e=e.eq("brand_id",r.id));let{data:t,error:a}=await e;if(a){console.error("Error fetching orders:",a);return}t&&c(t)}catch(e){console.error("Error fetching orders:",e)}finally{j(!1)}},updateOrderStatus=async(e,t)=>{if(w===e){console.log("Order update already in progress for:",e);return}N(e);try{if("released"===t){let{data:t,error:r}=await s.O.from("order_details").select("product_id, quantity").eq("order_id",e);if(r){console.error("Error fetching order details:",r),alert("Failed to fetch order details");return}for(let e of t||[]){let{data:t,error:r}=await s.O.from("products").select("reserved, released").eq("id",e.product_id).single();if(r){console.error("Error fetching product data:",r),alert("Failed to fetch product data");return}let a=Math.max(0,((null==t?void 0:t.reserved)||0)-e.quantity),n=((null==t?void 0:t.released)||0)+e.quantity,{error:i}=await s.O.from("products").update({reserved:a,released:n,updated_at:new Date().toISOString()}).eq("id",e.product_id);if(i){console.error("Error updating product quantities:",i),alert("Failed to update product quantities");return}}}if("cancelled"===t){let{data:t,error:r}=await s.O.from("order_details").select("product_id, quantity").eq("order_id",e);if(r){console.error("Error fetching order details:",r),alert("Failed to fetch order details");return}for(let e of t||[]){let{data:t,error:r}=await s.O.from("products").select("reserved").eq("id",e.product_id).single();if(r){console.error("Error fetching product data:",r),alert("Failed to fetch product data");return}let a=Math.max(0,((null==t?void 0:t.reserved)||0)-e.quantity),{error:n}=await s.O.from("products").update({reserved:a,updated_at:new Date().toISOString()}).eq("id",e.product_id);if(n){console.error("Error updating product quantities:",n),alert("Failed to update product quantities");return}}}let{error:r}=await s.O.from("customer_orders").update({status:t,updated_at:new Date().toISOString()}).eq("id",e);if(r){console.error("Error updating order status:",r),alert("Failed to update order status");return}fetchOrders(),i&&i()}catch(e){console.error("Error updating order status:",e),alert("Failed to update order status")}finally{N(null)}},handleDeleteOrder=async e=>{if(confirm("Are you sure you want to delete this order? This action cannot be undone."))try{N(e);let{error:t}=await s.O.from("order_details").delete().eq("order_id",e);if(t){console.error("Error deleting order details:",t),alert("Failed to delete order details");return}let{error:r}=await s.O.from("customer_orders").delete().eq("id",e);if(r){console.error("Error deleting order:",r),alert("Failed to delete order");return}fetchOrders(),i&&i()}catch(e){console.error("Error deleting order:",e),alert("Failed to delete order")}finally{N(null)}},getStatusIcon=e=>{switch(e){case"pending":return(0,a.jsx)(p,{className:"h-4 w-4 text-yellow-500"});case"approved":return(0,a.jsx)(l,{className:"h-4 w-4 text-blue-500"});case"released":return(0,a.jsx)(g,{className:"h-4 w-4 text-green-500"});case"cancelled":return(0,a.jsx)(h,{className:"h-4 w-4 text-red-500"});default:return(0,a.jsx)(p,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"released":return"bg-green-100 text-green-800";case"paid":return"bg-purple-100 text-purple-800";case"complete":return"bg-indigo-100 text-indigo-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getCategoryTotals=e=>{if(!e.order_details)return[];let t=new Map;return e.order_details.forEach(e=>{var r;let a=(null===(r=e.product)||void 0===r?void 0:r.category)&&""!==e.product.category.trim()?e.product.category:"Uncategorized";t.has(a)||t.set(a,{category:a,totalQuantity:0,totalAmount:0});let n=t.get(a);n.totalQuantity+=e.quantity,n.totalAmount+=e.unit_price*e.quantity}),Array.from(t.values())},getTotalAmount=e=>{let t=e.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0),r=t;return"delivery"===e.delivery_type?r+=t>=1e4?0:500:"pickup"===e.delivery_type&&t>=1e4&&(r-=.05*t),r},getSubtotalAmount=e=>e.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0),fetchAvailableProducts=async()=>{if(r)try{let{data:e,error:t}=await s.O.from("inventory_summary").select("*").eq("brand_id",r.id).order("category, product_name");if(t)throw t;L(e||[])}catch(e){console.error("Error fetching products:",e),alert("Failed to fetch products")}},handleSaveOverride=async()=>{if(O&&A&&r){T(!0);try{let t=new Map,r=new Set([...A.order_details.map(e=>e.product_id),...O.order_details.map(e=>e.product_id)]);for(let[a,n]of(r.forEach(e=>{var r,a;let n=(null===(r=A.order_details.find(t=>t.product_id===e))||void 0===r?void 0:r.quantity)||0,s=(null===(a=O.order_details.find(t=>t.product_id===e))||void 0===a?void 0:a.quantity)||0;t.set(e,s-n)}),Array.from(t.entries())))if(n>0){var e;let t=q.find(e=>e.id===a);if(!t){alert("Product not found: ".concat(a));return}let r=(null===(e=A.order_details.find(e=>e.product_id===a))||void 0===e?void 0:e.quantity)||0,s=(t.available_stock||0)+r;if(n>s){alert("Insufficient stock for ".concat(t.name,". Available: ").concat(s,", Requested: ").concat(n));return}}for(let[e,r]of Array.from(t.entries()))if(0!==r){let{data:t,error:a}=await s.O.from("products").select("reserved").eq("id",e).single();if(a){console.error("Error fetching current product:",a),alert("Failed to fetch current product data");return}let n=(t.reserved||0)+r,{error:i}=await s.O.from("products").update({reserved:n}).eq("id",e);if(i){console.error("Error updating inventory:",i),alert("Failed to update inventory");return}}let{error:a}=await s.O.from("order_details").delete().eq("order_id",O.id);if(a)throw a;if(O.order_details.length>0){let{error:e}=await s.O.from("order_details").insert(O.order_details.map(e=>({order_id:O.id,product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price})));if(e)throw e}let n=calculateOverrideTotal(),{error:l}=await s.O.from("customer_orders").update({total_amount:n,delivery_type:O.delivery_type,updated_at:new Date().toISOString()}).eq("id",O.id);if(l)throw l;await fetchOrders(),i&&i(),console.log("Override - New total calculated:",n),console.log("Override - Editing order details:",O.order_details),console.log("Override - Delivery type:",O.delivery_type),_({...k,total_amount:n,delivery_type:O.delivery_type,order_details:O.order_details}),C(!1),F(null),E(null),alert("Order updated successfully!")}catch(e){console.error("Error updating order:",e),alert("Failed to update order")}finally{T(!1)}}},addProductToOrder=e=>{var t;if(!O)return;let r=e.product_id||e.id,a=O.order_details.find(e=>e.product_id===r),n=a?a.quantity+1:1,s=(null===(t=A.order_details.find(e=>e.product_id===r))||void 0===t?void 0:t.quantity)||0,i=(e.available_stock||0)+s;if(n>i){alert("Insufficient stock for ".concat(e.product_name||e.name,". Available: ").concat(i,", Requested: ").concat(n));return}a?F({...O,order_details:O.order_details.map(t=>t.product_id===e.id?{...t,quantity:n}:t)}):F({...O,order_details:[...O.order_details,{id:"temp-".concat(Date.now()),order_id:O.id,product_id:r,quantity:1,unit_price:e.price||0,product:e}]})},removeProductFromOrder=e=>{O&&F({...O,order_details:O.order_details.filter(t=>t.product_id!==e)})},updateProductQuantity=(e,t)=>{if(!O||t<0)return;if(0===t){removeProductFromOrder(e);return}let r=q.find(t=>(t.product_id||t.id)===e);if(r){var a;let n=(null===(a=A.order_details.find(t=>t.product_id===e))||void 0===a?void 0:a.quantity)||0,s=(r.available_stock||0)+n;if(t>s){alert("Insufficient stock for ".concat(r.product_name||r.name,". Available: ").concat(s,", Requested: ").concat(t));return}}F({...O,order_details:O.order_details.map(r=>r.product_id===e?{...r,quantity:t}:r)})},calculateOverrideTotal=()=>{if(!O)return 0;let e=O.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0),t=e;return"delivery"===O.delivery_type?t+=e>=1e4?0:500:"pickup"===O.delivery_type&&e>=1e4&&(t-=.05*e),t},canIncreaseQuantity=e=>{var t,r;if(!O||!A)return!1;let a=q.find(t=>(t.product_id||t.id)===e);if(!a)return!1;let n=(null===(t=A.order_details.find(t=>t.product_id===e))||void 0===t?void 0:t.quantity)||0,s=(null===(r=O.order_details.find(t=>t.product_id===e))||void 0===r?void 0:r.quantity)||0,i=(a.available_stock||0)+n;return s<i},canAddProduct=e=>{var t,r;if(!O||!A)return!1;let a=e.product_id||e.id,n=(null===(t=A.order_details.find(e=>e.product_id===a))||void 0===t?void 0:t.quantity)||0,s=(null===(r=O.order_details.find(e=>e.product_id===a))||void 0===r?void 0:r.quantity)||0,i=(e.available_stock||0)+n;return s<i};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:(0,a.jsx)("div",{children:(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Customer Orders"})})}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Filter"}),(0,a.jsxs)("select",{value:S,onChange:e=>D(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Statuses"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"released",children:"Released"}),(0,a.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})}),v?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading orders..."})]}):0===d.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(y.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No orders found"})]}):(0,a.jsx)("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order Details"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Logistics"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(e=>{var t,r;return(0,a.jsxs)("tr",{className:"hover:bg-blue-100",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["#",e.id.slice(-8)]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:null===(t=e.brand)||void 0===t?void 0:t.name})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:null===(r=e.location)||void 0===r?void 0:r.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(getStatusColor(e.status)),children:[getStatusIcon(e.status),(0,a.jsx)("span",{className:"ml-1 capitalize",children:e.status})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,u.iI)(e.created_at,{dateStyle:"short"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("delivery"===e.delivery_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"delivery"===e.delivery_type?"Delivery":"Pickup"}),e.logistics_assignments&&e.logistics_assignments.length>0&&(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.logistics_assignments.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"•"}),(0,a.jsx)("span",{children:new Date(e.date).toLocaleDateString()}),(0,a.jsxs)("span",{className:"capitalize",children:["(",e.time_slot,")"]})]},e.id))})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["₱",getTotalAmount(e).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>_(e),className:"p-1 rounded text-blue-600 hover:text-blue-900 hover:bg-blue-100",title:"View Details",children:(0,a.jsx)(b,{className:"h-4 w-4"})}),"pending"===e.status&&(0,a.jsx)("button",{onClick:()=>updateOrderStatus(e.id,"approved"),disabled:w===e.id,className:"p-1 rounded ".concat(w===e.id?"text-gray-400 cursor-not-allowed":"text-green-600 hover:text-green-900 hover:bg-green-100"),title:"Approve Order",children:w===e.id?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"}):(0,a.jsx)(l,{className:"h-4 w-4"})}),"approved"===e.status&&(0,a.jsx)("button",{onClick:()=>updateOrderStatus(e.id,"released"),disabled:w===e.id,className:"p-1 rounded ".concat(w===e.id?"text-gray-400 cursor-not-allowed":"green"===o?"text-green-600 hover:text-green-900 hover:bg-green-100":"red"===o?"text-red-600 hover:text-red-900 hover:bg-red-100":"yellow"===o?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-100":"text-blue-600 hover:text-blue-900 hover:bg-blue-100"),title:"Release Order",children:w===e.id?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"}):(0,a.jsx)(g,{className:"h-4 w-4"})}),("pending"===e.status||"approved"===e.status)&&(0,a.jsx)("button",{onClick:()=>updateOrderStatus(e.id,"cancelled"),disabled:w===e.id,className:"".concat(w===e.id?"text-gray-400 cursor-not-allowed":"text-red-600 hover:text-red-900"),title:"Cancel Order",children:w===e.id?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"}):(0,a.jsx)(h,{className:"h-4 w-4"})}),("cancelled"===e.status||"released"===e.status)&&(0,a.jsx)("button",{onClick:()=>handleDeleteOrder(e.id),disabled:w===e.id,className:"".concat(w===e.id?"text-gray-400 cursor-not-allowed":"text-red-600 hover:text-red-900"),title:"Delete Order",children:w===e.id?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"}):(0,a.jsx)(m,{className:"h-4 w-4"})})]})})]},e.id)})})]})})}),k&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Order Details #",k.id.slice(0,8)]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:["approved"===k.status&&(0,a.jsxs)("button",{onClick:()=>{k&&(E({...k}),F({...k}),C(!0),fetchAvailableProducts())},className:"flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium bg-orange-100 text-orange-700 hover:bg-orange-200",children:[(0,a.jsx)(x,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Override"})]}),(0,a.jsxs)("button",{onClick:()=>{if(!k)return;let e=window.open("","_blank");if(e){var t,r;e.document.write("\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>Receipt - Order ".concat(k.id.slice(0,8),'</title>\n          <style>\n            \n            * { box-sizing: border-box; }\n            body { \n              font-family: Arial, sans-serif; \n              margin: 0; \n              padding: 10px; \n              background: white;\n              color: black;\n              line-height: 1.4;\n            }\n            \n            .receipt-container {\n              max-width: 100%;\n              width: 100%;\n              margin: 0;\n              background: white;\n              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n              border-radius: 8px;\n              overflow: hidden;\n              display: flex;\n              flex-direction: column;\n              min-height: 100vh;\n            }\n            \n            .header { \n              text-align: center; \n              padding: 16px 20px;\n              background: white;\n              color: black;\n              border-bottom: 2px solid black;\n            }\n            \n            .company-name { \n              font-size: 23px; \n              font-weight: bold; \n              margin-bottom: 4px;\n              color: black;\n            }\n            \n            .receipt-title { \n              font-size: 15px; \n              font-weight: normal; \n              color: black;\n            }\n            \n            .order-info { \n              padding: 8px 12px; \n              background: white;\n              border-bottom: 1px solid black;\n            }\n            \n            .info-grid {\n              display: grid;\n              grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n              gap: 4px 12px;\n            }\n            \n            .info-item {\n              display: flex;\n              flex-direction: column;\n            }\n            \n            .info-label { \n              font-weight: normal; \n              color: #666;\n              font-size: 12px;\n              text-transform: uppercase;\n              margin-bottom: 1px;\n            }\n            \n            .info-value { \n              font-weight: normal; \n              color: black;\n              font-size: 13px;\n            }\n            \n            .status-badge {\n              display: inline-block;\n              padding: 2px 6px;\n              border: 1px solid black;\n              font-size: 11px;\n              font-weight: normal;\n              text-transform: uppercase;\n            }\n            \n            .status-pending { background: white; color: black; }\n            .status-approved { background: white; color: black; }\n            .status-released { background: black; color: white; }\n            .status-cancelled { background: white; color: black; }\n            \n            .items { \n              padding: 8px 12px;\n              flex: 1;\n            }\n            \n            .items-title {\n              font-size: 13px;\n              font-weight: bold;\n              margin-bottom: 6px;\n              color: black;\n              text-transform: uppercase;\n            }\n            \n            .items-header {\n              display: grid;\n              grid-template-columns: 30px 2fr 1fr 1fr 1fr;\n              gap: 8px;\n              padding: 4px 0;\n              border-bottom: 1px solid black;\n              margin-bottom: 4px;\n            }\n            \n            .header-cell {\n              font-size: 11px;\n              font-weight: bold;\n              color: black;\n              text-transform: uppercase;\n            }\n            \n            .header-checkbox { text-align: center; }\n            .header-item { text-align: left; }\n            .header-qty { text-align: center; }\n            .header-price { text-align: center; }\n            .header-total { text-align: right; }\n            \n            .item-checkbox {\n              text-align: center;\n              display: flex;\n              justify-content: center;\n              align-items: center;\n            }\n            \n            .checkbox {\n              width: 14px;\n              height: 14px;\n              border: 1px solid black;\n              background: white;\n              cursor: pointer;\n            }\n            \n            .item-row {\n              display: grid;\n              grid-template-columns: 30px 2fr 1fr 1fr 1fr;\n              gap: 8px;\n              align-items: center;\n              padding: 4px 0;\n              border-bottom: 1px solid #ccc;\n            }\n            \n            .item-row:last-child {\n              border-bottom: none;\n            }\n            \n            .item-name {\n              font-weight: normal;\n              color: black;\n              margin-bottom: 1px;\n              font-size: 12px;\n            }\n            \n            .item-details {\n              font-size: 10px;\n              color: #666;\n            }\n            \n            .item-quantity {\n              text-align: center;\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .item-unit-price {\n              text-align: center;\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .item-price {\n              text-align: right;\n              font-weight: bold;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .total-section { \n              padding: 8px 12px;\n              background: white;\n              border-top: 1px solid black;\n            }\n            \n            .total-row {\n              display: flex;\n              justify-content: space-between;\n              align-items: center;\n              margin-bottom: 4px;\n            }\n            \n            .total-label {\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .total-value {\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .grand-total {\n              border-top: 1px solid black;\n              padding-top: 4px;\n              margin-top: 4px;\n            }\n            \n            .grand-total .total-label {\n              font-size: 13px;\n              font-weight: bold;\n            }\n            \n            .grand-total .total-value {\n              font-size: 14px;\n              font-weight: bold;\n              color: black;\n            }\n            \n            .footer { \n              text-align: center; \n              padding: 6px 12px;\n              background: black;\n              color: white;\n              margin-top: auto;\n            }\n            \n            .footer-text {\n              font-size: 11px;\n              margin-bottom: 2px;\n            }\n            \n            .footer-date {\n              font-size: 10px;\n            }\n            \n            .notes {\n              padding: 6px 12px;\n              background: white;\n              border: 1px solid black;\n              margin: 0 12px 8px;\n            }\n            \n            .notes-title {\n              font-weight: bold;\n              color: black;\n              margin-bottom: 2px;\n              font-size: 11px;\n            }\n            \n            .notes-text {\n              color: black;\n              font-size: 11px;\n            }\n            \n            .signatories {\n              margin-top: 20px;\n              padding-top: 15px;\n              border-top: 1px solid #ddd;\n            }\n            \n            .signatories-row {\n              display: grid;\n              grid-template-columns: 1fr 1fr 1fr 0.5fr;\n              gap: 15px;\n              margin-bottom: 15px;\n            }\n            \n            .signatory-item {\n              text-align: center;\n            }\n            \n            .signatory-item.returned-pans {\n              min-width: 80px;\n            }\n            \n            .signatory-label {\n              font-size: 11px;\n              color: #333;\n              margin-bottom: 25px;\n              font-weight: 500;\n            }\n            \n            .signatory-line {\n              border-bottom: 1px solid #333;\n              height: 20px;\n              margin-bottom: 5px;\n            }\n            \n            .signatory-line.small {\n              height: 20px;\n              width: 60px;\n              margin: 0 auto 5px auto;\n            }\n            \n            .signatory-name {\n              font-size: 10px;\n              color: #666;\n              font-style: italic;\n            }\n            \n            @media print { \n              body { margin: 0; padding: 0; }\n              .receipt-container { box-shadow: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="receipt-container">\n            <div class="header">\n              <div class="company-name">').concat((null===(t=k.brand)||void 0===t?void 0:t.name)||"Company",'</div>\n              <div class="receipt-title">Stock Transfer Sheet</div>\n            </div>\n            \n            <div class="order-info">\n              <div class="info-grid">\n                <div class="info-item">\n                  <span class="info-label">Order ID</span>\n                  <span class="info-value">').concat(k.id.slice(0,8),'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Date (PST)</span>\n                  <span class="info-value">').concat((0,u.iI)(k.created_at,{dateStyle:"short"}),'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Location</span>\n                  <span class="info-value">').concat((null===(r=k.location)||void 0===r?void 0:r.name)||"N/A",'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Status</span>\n                  <span class="info-value">').concat(k.status,'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Logistics</span>\n                  <span class="info-value">').concat("delivery"===k.delivery_type?"Delivery":"Pickup",'</span>\n                </div>\n              </div>\n            </div>\n            \n            <div class="items">\n              <div class="items-header">\n                <div class="header-cell header-checkbox">✓</div>\n                <div class="header-cell header-item">Item</div>\n                <div class="header-cell header-qty">Quantity</div>\n                <div class="header-cell header-price">Unit Price</div>\n                <div class="header-cell header-total">Total</div>\n              </div>\n              ').concat(k.order_details.map(e=>'\n                <div class="item-row">\n                  <div class="item-checkbox">\n                    <div class="checkbox"></div>\n                  </div>\n                  <div>\n                    <div class="item-name">'.concat(e.product.name,'</div>\n                    <div class="item-details">\n                      ').concat(e.product.sku?"SKU: ".concat(e.product.sku):"",'\n                    </div>\n                  </div>\n                  <div class="item-quantity">').concat(e.quantity," ").concat(e.product.unit,'</div>\n                  <div class="item-unit-price">₱').concat(e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),'</div>\n                  <div class="item-price">₱').concat((e.unit_price*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</div>\n                </div>\n              ")).join(""),"\n            </div>\n            \n            ").concat(k.notes?'\n              <div class="notes">\n                <div class="notes-title">Notes</div>\n                <div class="notes-text">'.concat(k.notes,"</div>\n              </div>\n            "):"",'\n            \n            <div class="total-section">\n              ').concat(getCategoryTotals(k).map(e=>'\n                <div class="total-row">\n                  <span class="total-label">'.concat(e.category,": ").concat(e.totalQuantity,' items</span>\n                  <span class="total-value">₱').concat(e.totalAmount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                </div>\n              ")).join(""),'\n              <div class="total-row">\n                <span class="total-label">Subtotal</span>\n                <span class="total-value">₱').concat(getSubtotalAmount(k).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n              </div>\n              ").concat("delivery"===k.delivery_type?'\n                <div class="total-row">\n                  <span class="total-label">Delivery Fee</span>\n                  <span class="total-value">'.concat(getSubtotalAmount(k)>=1e4?"FREE (Order over ₱10k)":"+₱500.00","</span>\n                </div>\n              "):"","\n              ").concat("pickup"===k.delivery_type&&getSubtotalAmount(k)>=1e4?'\n                <div class="total-row">\n                  <span class="total-label">Pickup Discount (5%)</span>\n                  <span class="total-value">-₱'.concat((.05*getSubtotalAmount(k)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                </div>\n              "):"","\n              ").concat("pickup"===k.delivery_type&&1e4>getSubtotalAmount(k)?'\n                <div class="total-row">\n                  <span class="total-label">Pickup Discount</span>\n                  <span class="total-value">Not available (Order under ₱10k)</span>\n                </div>\n              ':"",'\n              <div class="total-row grand-total">\n                <span class="total-label">Total Amount</span>\n                <span class="total-value">₱').concat(getTotalAmount(k).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),'</span>\n              </div>\n            </div>\n            \n            <div class="signatories">\n              <div class="signatories-row">\n                <div class="signatory-item">\n                  <div class="signatory-label">Prepared by:</div>\n                  <div class="signatory-line"></div>\n                </div>\n                <div class="signatory-item">\n                  <div class="signatory-label">Delivered by:</div>\n                  <div class="signatory-line"></div>\n                </div>\n                <div class="signatory-item">\n                  <div class="signatory-label">Received by:</div>\n                  <div class="signatory-line"></div>\n                </div>\n                <div class="signatory-item returned-pans">\n                  <div class="signatory-label">Returned pans:</div>\n                  <div class="signatory-line small"></div>\n                </div>\n              </div>\n            </div>\n            \n            <div class="footer">\n              <div class="footer-text">Thank you for your order!</div>\n              <div class="footer-date">Generated on ').concat(new Date().toLocaleString(),"</div>\n            </div>\n          </div>\n        </body>\n        </html>\n      ")),e.document.close(),e.focus(),e.print(),e.close()}},className:"flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium ".concat("green"===o?"bg-green-100 text-green-700 hover:bg-green-200":"red"===o?"bg-red-100 text-red-700 hover:bg-red-200":"yellow"===o?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Print Transfer Sheet"})]}),(0,a.jsx)("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(h,{className:"h-6 w-6"})})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created Date"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:(0,u.iI)(k.created_at,{dateStyle:"short",timeStyle:"short"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat("pending"===k.status?"bg-yellow-100 text-yellow-800":"approved"===k.status?"bg-blue-100 text-blue-800":"released"===k.status?"bg-orange-100 text-orange-800":"paid"===k.status?"bg-purple-100 text-purple-800":"complete"===k.status?"bg-indigo-100 text-indigo-800":"cancelled"===k.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:k.status.charAt(0).toUpperCase()+k.status.slice(1)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Logistics"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat("delivery"===k.delivery_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"delivery"===k.delivery_type?"Delivery":"Pickup"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:(null===(t=k.location)||void 0===t?void 0:t.name)||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Amount"}),(0,a.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:["₱",getTotalAmount(k).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Category Totals"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:getCategoryTotals(k).map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded p-2 border text-center",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900",children:e.category}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[e.totalQuantity," items"]}),(0,a.jsxs)("p",{className:"text-xs font-semibold text-green-600",children:["₱",e.totalAmount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t))})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Pricing Breakdown"}),(0,a.jsxs)("div",{className:"bg-white rounded p-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:["₱",getSubtotalAmount(k).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===k.delivery_type&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),getSubtotalAmount(k)>=1e4?(0,a.jsx)("span",{className:"text-sm text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-sm text-gray-900",children:"+₱500.00"})]}),"pickup"===k.delivery_type&&getSubtotalAmount(k)>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["-₱",(.05*getSubtotalAmount(k)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===k.delivery_type&&1e4>getSubtotalAmount(k)&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"text-sm font-semibold text-green-600",children:["₱",getTotalAmount(k).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})]})]}),k.notes&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:k.notes})]}),k.order_details&&k.order_details.length>0&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b",children:(0,a.jsxs)("h4",{className:"text-sm font-semibold text-gray-900",children:["Order Items (",k.order_details.length,")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.order_details.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.product.name}),e.product.sku&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["SKU: ",e.product.sku]})]})}),(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:[e.quantity," ",e.product.unit]}),(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["₱",e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["₱",(e.unit_price*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},e.id))})]})})]})]})]})}),P&&O&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3 shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Override Order #",O.id.slice(0,8)]}),(0,a.jsx)("button",{onClick:()=>{C(!1),F(null),E(null)},className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(h,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logistics Method"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"delivery_type",value:"delivery",checked:"delivery"===O.delivery_type,onChange:e=>F({...O,delivery_type:e.target.value}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Delivery"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"delivery_type",value:"pickup",checked:"pickup"===O.delivery_type,onChange:e=>F({...O,delivery_type:e.target.value}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Pickup"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Current Order Items"}),(0,a.jsx)("div",{className:"space-y-2",children:O.order_details.map(e=>{var t,r;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:(null===(t=e.product)||void 0===t?void 0:t.product_name)||(null===(r=e.product)||void 0===r?void 0:r.name)||"Unknown Product"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["₱",e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})," each"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>updateProductQuantity(e.product_id,e.quantity-1),className:"px-2 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200",children:"-"}),(0,a.jsx)("span",{className:"w-12 text-center",children:e.quantity}),(0,a.jsx)("button",{onClick:()=>updateProductQuantity(e.product_id,e.quantity+1),disabled:!canIncreaseQuantity(e.product_id),className:"px-2 py-1 text-sm rounded ".concat(canIncreaseQuantity(e.product_id)?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:"+"}),(0,a.jsx)("button",{onClick:()=>removeProductFromOrder(e.product_id),className:"px-2 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 ml-2",children:"Remove"})]})]},e.id)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Add Products"}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-4",children:(()=>{let e=q.reduce((e,t)=>{let r=t.category||"Uncategorized";return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.entries(e).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h5",{className:"text-sm font-semibold text-gray-700 border-b border-gray-200 pb-1",children:t}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:r.map(e=>{var t;let r=canAddProduct(e),n=(null==A?void 0:null===(t=A.order_details.find(t=>t.product_id===e.id))||void 0===t?void 0:t.quantity)||0,s=(e.available_stock||0)+n;return(0,a.jsxs)("button",{onClick:()=>r&&addProductToOrder(e),disabled:!r,className:"p-2 text-left border rounded text-sm ".concat(r?"border-gray-200 hover:bg-gray-50":"border-gray-100 bg-gray-50 cursor-not-allowed"),children:[(0,a.jsx)("div",{className:"font-medium ".concat(r?"text-gray-900":"text-gray-400"),children:e.product_name||e.name}),(0,a.jsxs)("div",{className:"".concat(r?"text-gray-500":"text-gray-400"),children:["₱",(e.price||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-300"),children:["Available: ",s," / ",e.initial_stock]})]},e.id)})})]},t)})})()})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Order Summary"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["₱",O.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===O.delivery_type&&(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:O.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0)>=1e4?"FREE (Order over ₱10k)":"+₱500.00"})]}),"pickup"===O.delivery_type&&O.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0)>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-green-600",children:["-₱",(.05*O.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===O.delivery_type&&1e4>O.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0)&&(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-300",children:[(0,a.jsx)("span",{className:"text-lg font-medium text-gray-900",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["₱",calculateOverrideTotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>{C(!1),F(null),E(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{F({...O,total_amount:calculateOverrideTotal()}),handleSaveOverride()},disabled:z,className:"px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-md hover:bg-orange-700 disabled:opacity-50",children:z?"Saving...":"Save Changes"})]})]})]})})]})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let v=(0,i.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function BranchManager(e){var t,r;let{selectedBrand:i,theme:l="blue"}=e,[p,g]=(0,n.useState)([]),[h,y]=(0,n.useState)([]),[j,w]=(0,n.useState)(!1),[N,k]=(0,n.useState)(!1),[_,S]=(0,n.useState)(null),[D,P]=(0,n.useState)(null),[C,O]=(0,n.useState)([]),[F,A]=(0,n.useState)(!1),[E,q]=(0,n.useState)(!1),[L,z]=(0,n.useState)(null),[T,I]=(0,n.useState)({name:"",passkey:"",franchisee:"",contact_number:"",company_owned:!1,brand_id:(null==i?void 0:i.id)||""});(0,n.useEffect)(()=>{i&&(fetchLocations(),fetchBrands(),I(e=>({...e,brand_id:i.id})),A(!1),P(null),O([]),q(!1),z(null))},[i]),(0,n.useEffect)(()=>{if(!i)return;let e=s.O.channel("branch-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"customer_orders",filter:"brand_id=eq.".concat(i.id)},e=>{console.log("Branch orders realtime update:",e),F&&D&&fetchLocationOrders(D.id)}).subscribe();return()=>{s.O.removeChannel(e)}},[i,F,D]);let fetchLocations=async()=>{if(i){w(!0);try{let{data:e,error:t}=await s.O.from("locations").select("\n          *,\n          brand:brands(*)\n        ").eq("brand_id",i.id).order("name");if(t){console.error("Error fetching locations:",t);return}e&&g(e)}catch(e){console.error("Error fetching locations:",e)}finally{w(!1)}}},fetchBrands=async()=>{try{let{data:e,error:t}=await s.O.from("brands").select("*").order("name");if(t){console.error("Error fetching brands:",t);return}e&&y(e)}catch(e){console.error("Error fetching brands:",e)}},handleAddLocation=async e=>{if(e.preventDefault(),!T.name||!T.passkey||!T.franchisee||!T.contact_number){alert("Please fill in all required fields");return}try{let{data:e,error:t}=await s.O.from("locations").insert([T]).select();if(t){console.error("Error adding location:",t),alert("Error adding location");return}e&&(g([...p,e[0]]),I({name:"",passkey:"",franchisee:"",contact_number:"",company_owned:!1,brand_id:(null==i?void 0:i.id)||""}),k(!1))}catch(e){console.error("Error adding location:",e),alert("Error adding location")}},handleUpdateLocation=async e=>{try{let{data:t,error:r}=await s.O.from("locations").update({name:e.name,passkey:e.passkey,franchisee:e.franchisee,contact_number:e.contact_number,company_owned:e.company_owned,brand_id:e.brand_id,updated_at:new Date().toISOString()}).eq("id",e.id).select();if(r){console.error("Error updating location:",r),alert("Error updating location");return}t&&(g(p.map(r=>r.id===e.id?{...t[0],brand:e.brand}:r)),S(null))}catch(e){console.error("Error updating location:",e),alert("Error updating location")}},handleDeleteLocation=async e=>{if(confirm("Are you sure you want to delete this location?"))try{let{error:t}=await s.O.from("locations").delete().eq("id",e);if(t){console.error("Error deleting location:",t),alert("Error deleting location");return}g(p.filter(t=>t.id!==e))}catch(e){console.error("Error deleting location:",e),alert("Error deleting location")}},fetchLocationOrders=async e=>{w(!0);try{let{data:t,error:r}=await s.O.from("customer_orders").select("\n          *,\n          location:locations(*),\n          brand:brands(*),\n          order_details(\n            *,\n            product:products(id, name, sku, unit, category)\n          )\n        ").eq("location_id",e).order("created_at",{ascending:!1});if(r){console.error("Error fetching orders:",r);return}t&&O(t)}catch(e){console.error("Error fetching orders:",e)}finally{w(!1)}},handleViewOrderHistory=async e=>{P(e),A(!0),await fetchLocationOrders(e.id)},copyToClipboard=async e=>{try{await navigator.clipboard.writeText(e),console.log("Passkey copied to clipboard:",e)}catch(r){console.error("Failed to copy passkey:",r);let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}},getStatusBadge=e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat({pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",released:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),children:e.charAt(0).toUpperCase()+e.slice(1)}),getSubtotalAmount=e=>e.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0),getCategoryTotals=e=>{let t=new Map;return e.order_details.forEach(e=>{var r;let a=(null===(r=e.product)||void 0===r?void 0:r.category)||"Uncategorized",n=t.get(a)||{category:a,totalQuantity:0,totalAmount:0};n.totalQuantity+=e.quantity,n.totalAmount+=e.unit_price*e.quantity,t.set(a,n)}),Array.from(t.values())},handleViewDetails=e=>{z(e),q(!0)},handlePrintReceipt=e=>{let t=window.open("","_blank");if(t){var r,a,n;t.document.write("\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>Receipt - Order ".concat(e.id.slice(0,8),'</title>\n          <style>\n            \n            * { box-sizing: border-box; }\n            body { \n              font-family: Arial, sans-serif; \n              margin: 0; \n              padding: 10px; \n              background: white;\n              color: black;\n              line-height: 1.4;\n            }\n            \n            .receipt-container {\n              max-width: 100%;\n              width: 100%;\n              margin: 0;\n              background: white;\n              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n              border-radius: 8px;\n              overflow: hidden;\n              display: flex;\n              flex-direction: column;\n              min-height: 100vh;\n            }\n            \n            .header { \n              text-align: center; \n              padding: 16px 20px;\n              background: white;\n              color: black;\n              border-bottom: 2px solid black;\n            }\n            \n            .company-name { \n              font-size: 23px; \n              font-weight: bold; \n              margin-bottom: 4px;\n              color: black;\n            }\n            \n            .receipt-title { \n              font-size: 15px; \n              font-weight: normal; \n              color: black;\n            }\n            \n            .order-info { \n              padding: 8px 12px; \n              background: white;\n              border-bottom: 1px solid black;\n            }\n            \n            .info-grid {\n              display: grid;\n              grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n              gap: 4px 12px;\n            }\n            \n            .info-item {\n              display: flex;\n              flex-direction: column;\n            }\n            \n            .info-label { \n              font-weight: normal; \n              color: #666;\n              font-size: 12px;\n              text-transform: uppercase;\n              margin-bottom: 1px;\n            }\n            \n            .info-value { \n              font-weight: normal; \n              color: black;\n              font-size: 13px;\n            }\n            \n            .status-badge {\n              display: inline-block;\n              padding: 2px 6px;\n              border: 1px solid black;\n              font-size: 11px;\n              font-weight: normal;\n              text-transform: uppercase;\n            }\n            \n            .status-pending { background: white; color: black; }\n            .status-approved { background: white; color: black; }\n            .status-released { background: black; color: white; }\n            .status-cancelled { background: white; color: black; }\n            \n            .items { \n              padding: 8px 12px;\n              flex: 1;\n            }\n            \n            .items-title {\n              font-size: 13px;\n              font-weight: bold;\n              margin-bottom: 6px;\n              color: black;\n              text-transform: uppercase;\n            }\n            \n            .items-header {\n              display: grid;\n              grid-template-columns: 30px 2fr 1fr 1fr 1fr;\n              gap: 8px;\n              padding: 4px 0;\n              border-bottom: 1px solid black;\n              margin-bottom: 4px;\n            }\n            \n            .header-cell {\n              font-size: 11px;\n              font-weight: bold;\n              color: black;\n              text-transform: uppercase;\n            }\n            \n            .header-checkbox { text-align: center; }\n            .header-item { text-align: left; }\n            .header-qty { text-align: center; }\n            .header-price { text-align: center; }\n            .header-total { text-align: right; }\n            \n            .item-checkbox {\n              text-align: center;\n              display: flex;\n              justify-content: center;\n              align-items: center;\n            }\n            \n            .checkbox {\n              width: 14px;\n              height: 14px;\n              border: 1px solid black;\n              background: white;\n              cursor: pointer;\n            }\n            \n            .item-row {\n              display: grid;\n              grid-template-columns: 30px 2fr 1fr 1fr 1fr;\n              gap: 8px;\n              align-items: center;\n              padding: 4px 0;\n              border-bottom: 1px solid #ccc;\n            }\n            \n            .item-row:last-child {\n              border-bottom: none;\n            }\n            \n            .item-name {\n              font-weight: normal;\n              color: black;\n              margin-bottom: 1px;\n              font-size: 12px;\n            }\n            \n            .item-details {\n              font-size: 10px;\n              color: #666;\n            }\n            \n            .item-quantity {\n              text-align: center;\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .item-unit-price {\n              text-align: center;\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .item-price {\n              text-align: right;\n              font-weight: bold;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .total-section { \n              padding: 8px 12px;\n              background: white;\n              border-top: 1px solid black;\n            }\n            \n            .total-row {\n              display: flex;\n              justify-content: space-between;\n              align-items: center;\n              margin-bottom: 4px;\n            }\n            \n            .total-label {\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .total-value {\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .grand-total {\n              border-top: 1px solid black;\n              padding-top: 4px;\n              margin-top: 4px;\n            }\n            \n            .grand-total .total-label {\n              font-size: 13px;\n              font-weight: bold;\n            }\n            \n            .grand-total .total-value {\n              font-size: 14px;\n              font-weight: bold;\n              color: black;\n            }\n            \n            .footer { \n              text-align: center; \n              padding: 6px 12px;\n              background: black;\n              color: white;\n              margin-top: auto;\n            }\n            \n            .footer-text {\n              font-size: 11px;\n              margin-bottom: 2px;\n            }\n            \n            .footer-date {\n              font-size: 10px;\n            }\n            \n            .notes {\n              padding: 6px 12px;\n              background: white;\n              border: 1px solid black;\n              margin: 0 12px 8px;\n            }\n            \n            .notes-title {\n              font-weight: bold;\n              color: black;\n              margin-bottom: 2px;\n              font-size: 11px;\n            }\n            \n            .notes-text {\n              color: black;\n              font-size: 11px;\n            }\n            \n            @media print { \n              body { margin: 0; padding: 0; }\n              .receipt-container { box-shadow: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="receipt-container">\n          <div class="header">\n              <div class="company-name">').concat((null===(r=e.brand)||void 0===r?void 0:r.name)||"Company",'</div>\n              <div class="receipt-title">Stock Transfer Sheet</div>\n          </div>\n          \n          <div class="order-info">\n              <div class="info-grid">\n                <div class="info-item">\n                  <span class="info-label">Order ID</span>\n                  <span class="info-value">').concat(e.id.slice(0,8),'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Date (PST)</span>\n                  <span class="info-value">').concat((0,u.iI)(e.created_at,{dateStyle:"short"}),'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Location</span>\n                  <span class="info-value">').concat((null===(a=e.location)||void 0===a?void 0:a.name)||"N/A",'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Franchisee</span>\n                  <span class="info-value">').concat((null===(n=e.location)||void 0===n?void 0:n.franchisee)||"N/A",'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Logistics</span>\n                  <span class="info-value">').concat("delivery"===e.delivery_type?"Delivery":"Pickup",'</span>\n                </div>\n              </div>\n          </div>\n          \n          <div class="items">\n              <div class="items-header">\n                <div class="header-cell header-checkbox">✓</div>\n                <div class="header-cell header-item">Item</div>\n                <div class="header-cell header-qty">Quantity</div>\n                <div class="header-cell header-price">Unit Price</div>\n                <div class="header-cell header-total">Total</div>\n              </div>\n              ').concat(e.order_details.map(e=>'\n                <div class="item-row">\n                  <div class="item-checkbox">\n                    <div class="checkbox"></div>\n                  </div>\n                  <div>\n                    <div class="item-name">'.concat(e.product.name,'</div>\n                    <div class="item-details">\n                      ').concat(e.product.sku?"SKU: ".concat(e.product.sku):"",'\n                    </div>\n                  </div>\n                  <div class="item-quantity">').concat(e.quantity," ").concat(e.product.unit,'</div>\n                  <div class="item-unit-price">₱').concat(e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),'</div>\n                  <div class="item-price">₱').concat((e.unit_price*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</div>\n                </div>\n              ")).join(""),"\n          </div>\n          \n            ").concat(e.notes?'\n              <div class="notes">\n                <div class="notes-title">Notes</div>\n                <div class="notes-text">'.concat(e.notes,"</div>\n              </div>\n            "):"",'\n            \n            <div class="total-section">\n              ').concat(getCategoryTotals(e).map(e=>'\n                <div class="total-row">\n                  <span class="total-label">'.concat(e.category,": ").concat(e.totalQuantity,' items</span>\n                  <span class="total-value">₱').concat(e.totalAmount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                </div>\n              ")).join(""),'\n              <div class="total-row">\n                <span class="total-label">Subtotal</span>\n                <span class="total-value">₱').concat(getSubtotalAmount(e).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n              </div>\n              ").concat("delivery"===e.delivery_type?'\n                <div class="total-row">\n                  <span class="total-label">Delivery Fee</span>\n                  <span class="total-value">'.concat(getSubtotalAmount(e)>=1e4?"FREE (Order over ₱10k)":"+₱500.00","</span>\n                </div>\n              "):"","\n              ").concat("pickup"===e.delivery_type&&getSubtotalAmount(e)>=1e4?'\n                <div class="total-row">\n                  <span class="total-label">Pickup Discount (5%)</span>\n                  <span class="total-value">-₱'.concat((.05*getSubtotalAmount(e)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                </div>\n              "):"","\n              ").concat("pickup"===e.delivery_type&&1e4>getSubtotalAmount(e)?'\n                <div class="total-row">\n                  <span class="total-label">Pickup Discount</span>\n                  <span class="total-value">Not available (Order under ₱10k)</span>\n                </div>\n              ':"",'\n              <div class="total-row grand-total">\n                <span class="total-label">Total Amount</span>\n                <span class="total-value">₱').concat(e.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),'</span>\n              </div>\n          </div>\n          \n          <div class="footer">\n              <div class="footer-text">Thank you for your order!</div>\n              <div class="footer-date">Generated on ').concat(new Date().toLocaleString(),"</div>\n            </div>\n          </div>\n        </body>\n        </html>\n      ")),t.document.close(),t.focus(),t.print(),t.close()}};return F&&D?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Order History"}),(0,a.jsx)("p",{className:"text-gray-600",children:D.name})]}),(0,a.jsxs)("button",{onClick:()=>{A(!1),P(null)},className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Back to Branches"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Branch Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Total Orders"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:C.length})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-600 font-medium",children:"Total Revenue"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-900",children:["₱",C.reduce((e,t)=>e+(t.total_amount||0),0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-purple-600 font-medium",children:"Total Paid"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-purple-900",children:["₱",C.filter(e=>"paid"===e.status||"complete"===e.status).reduce((e,t)=>e+(t.total_amount||0),0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-orange-600 font-medium",children:"Total Receivable"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-orange-900",children:["₱",C.filter(e=>"released"===e.status).reduce((e,t)=>e+(t.total_amount||0),0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),j?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-blue-100",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[e.id.slice(0,8),"..."]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:D.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:getStatusBadge(e.status)}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["₱",e.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[(null===(t=e.order_details)||void 0===t?void 0:t.length)||0," items"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>handleViewDetails(e),className:"p-1 rounded text-blue-600 hover:text-blue-900 hover:bg-blue-50 transition-all duration-200 ease-in-out",title:"View Details",children:(0,a.jsx)(b,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handlePrintReceipt(e),className:"p-1 rounded text-blue-600 hover:text-blue-900 hover:bg-blue-50 transition-all duration-200 ease-in-out",title:"Print Receipt",children:(0,a.jsx)(f.Z,{className:"h-4 w-4"})})]})})]},e.id)})})]})})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Branch Manager"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage branch locations and view order history"})]}),(0,a.jsxs)("button",{onClick:()=>k(!0),className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors ".concat("green"===l?"bg-green-600 hover:bg-green-700":"red"===l?"bg-red-600 hover:bg-red-700":"yellow"===l?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Add Branch"})]})]}),N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Branch"}),(0,a.jsx)("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-6 w-6"})})]}),(0,a.jsxs)("form",{onSubmit:handleAddLocation,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Branch Name *"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"text",required:!0,value:T.name,onChange:e=>I({...T,name:e.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent ".concat("green"===l?"focus:ring-green-500":"red"===l?"focus:ring-red-500":"yellow"===l?"focus:ring-yellow-500":"focus:ring-blue-500"),placeholder:"Enter branch name"}),(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm text-gray-700",children:[(0,a.jsx)("input",{type:"checkbox",checked:T.company_owned,onChange:e=>I({...T,company_owned:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("span",{children:"Company Owned"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Passkey *"}),(0,a.jsx)("input",{type:"text",required:!0,value:T.passkey,onChange:e=>I({...T,passkey:e.target.value.replace(/\D/g,"").slice(0,6)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent ".concat("green"===l?"focus:ring-green-500":"red"===l?"focus:ring-red-500":"yellow"===l?"focus:ring-yellow-500":"focus:ring-blue-500"),placeholder:"Enter 6-digit passkey",maxLength:6})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Franchisee Name *"}),(0,a.jsx)("input",{type:"text",required:!0,value:T.franchisee,onChange:e=>I({...T,franchisee:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent ".concat("green"===l?"focus:ring-green-500":"red"===l?"focus:ring-red-500":"yellow"===l?"focus:ring-yellow-500":"focus:ring-blue-500"),placeholder:"Enter franchisee name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number *"}),(0,a.jsx)("input",{type:"tel",required:!0,value:T.contact_number,onChange:e=>I({...T,contact_number:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent ".concat("green"===l?"focus:ring-green-500":"red"===l?"focus:ring-red-500":"yellow"===l?"focus:ring-yellow-500":"focus:ring-blue-500"),placeholder:"Enter contact number"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors ".concat("green"===l?"bg-green-600 hover:bg-green-700":"red"===l?"bg-red-600 hover:bg-red-700":"yellow"===l?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(c,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Add Branch"})]})]})]})]})}),j?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Branch Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Passkey"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Franchisee"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-blue-100",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(null==_?void 0:_.id)===e.id?(0,a.jsx)("input",{type:"text",value:_.name,onChange:e=>S({..._,name:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded"}):e.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==_?void 0:_.id)===e.id?(0,a.jsx)("input",{type:"text",value:_.passkey,onChange:e=>S({..._,passkey:e.target.value.replace(/\D/g,"").slice(0,6)}),className:"w-full px-2 py-1 border border-gray-300 rounded",maxLength:6}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-mono",children:e.passkey}),(0,a.jsx)("button",{onClick:()=>copyToClipboard(e.passkey),className:"p-1 rounded hover:bg-gray-100 transition-colors ".concat("green"===l?"text-green-600 hover:text-green-700":"red"===l?"text-red-600 hover:text-red-700":"yellow"===l?"text-yellow-600 hover:text-yellow-700":"text-blue-600 hover:text-blue-700"),title:"Copy passkey",children:(0,a.jsx)(v,{className:"h-4 w-4"})})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==_?void 0:_.id)===e.id?(0,a.jsx)("input",{type:"text",value:_.franchisee||"",onChange:e=>S({..._,franchisee:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded"}):e.franchisee||"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==_?void 0:_.id)===e.id?(0,a.jsx)("input",{type:"tel",value:_.contact_number||"",onChange:e=>S({..._,contact_number:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded"}):e.contact_number||"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==_?void 0:_.id)===e.id?(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:_.company_owned||!1,onChange:e=>S({..._,company_owned:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"Company Owned"})]}):(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.company_owned?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.company_owned?"Company Owned":"Franchise"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("div",{className:"flex space-x-2",children:(null==_?void 0:_.id)===e.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>handleUpdateLocation(_),className:"p-1 rounded transition-all duration-200 ease-in-out ".concat("green"===l?"text-green-600 hover:text-green-900 hover:bg-green-50":"red"===l?"text-red-600 hover:text-red-900 hover:bg-red-50":"yellow"===l?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-50":"text-blue-600 hover:text-blue-900 hover:bg-blue-50"),title:"Save",children:(0,a.jsx)(c,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>S(null),className:"p-1 rounded text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-all duration-200 ease-in-out",title:"Cancel",children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>S(e),className:"p-1 rounded transition-all duration-200 ease-in-out ".concat("green"===l?"text-green-600 hover:text-green-900 hover:bg-green-50":"red"===l?"text-red-600 hover:text-red-900 hover:bg-red-50":"yellow"===l?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-50":"text-blue-600 hover:text-blue-900 hover:bg-blue-50"),title:"Edit",children:(0,a.jsx)(x,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handleViewOrderHistory(e),className:"p-1 rounded text-blue-600 hover:text-blue-900 hover:bg-blue-50 transition-all duration-200 ease-in-out",title:"View Order History",children:(0,a.jsx)(b,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handleDeleteLocation(e.id),className:"p-1 rounded text-red-600 hover:text-red-900 hover:bg-red-50 transition-all duration-200 ease-in-out",title:"Delete",children:(0,a.jsx)(m,{className:"h-4 w-4"})})]})})})]},e.id))})]})})}),E&&L&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Order Details #",L.id.slice(0,8)]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>handlePrintReceipt(L),className:"flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium ".concat("green"===l?"bg-green-100 text-green-700 hover:bg-green-200":"red"===l?"bg-red-100 text-red-700 hover:bg-red-200":"yellow"===l?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Print Transfer Sheet"})]}),(0,a.jsx)("button",{onClick:()=>{q(!1),z(null)},className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-6 w-6"})})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created Date"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:(0,u.iI)(L.created_at,{dateStyle:"short",timeStyle:"short"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat("pending"===L.status?"bg-yellow-100 text-yellow-800":"approved"===L.status?"bg-blue-100 text-blue-800":"released"===L.status?"bg-orange-100 text-orange-800":"paid"===L.status?"bg-purple-100 text-purple-800":"complete"===L.status?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-800"),children:L.status.charAt(0).toUpperCase()+L.status.slice(1)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Logistics"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat("delivery"===L.delivery_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"delivery"===L.delivery_type?"Delivery":"Pickup"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:(null===(t=L.location)||void 0===t?void 0:t.name)||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Amount"}),(0,a.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:["₱",L.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Category Totals"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:getCategoryTotals(L).map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded p-2 border text-center",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900",children:e.category}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[e.totalQuantity," items"]}),(0,a.jsxs)("p",{className:"text-xs font-semibold text-green-600",children:["₱",e.totalAmount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t))})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Pricing Breakdown"}),(0,a.jsxs)("div",{className:"bg-white rounded p-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:["₱",getSubtotalAmount(L).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===L.delivery_type&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),getSubtotalAmount(L)>=1e4?(0,a.jsx)("span",{className:"text-sm text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-sm text-gray-900",children:"+₱500.00"})]}),"pickup"===L.delivery_type&&getSubtotalAmount(L)>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["-₱",(.05*getSubtotalAmount(L)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===L.delivery_type&&1e4>getSubtotalAmount(L)&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center border-t pt-2",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"text-sm font-semibold text-green-600",children:["₱",L.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})]})]}),L.notes&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:L.notes})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b",children:(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Order Items"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:null===(r=L.order_details)||void 0===r?void 0:r.map((e,t)=>{var r,n,s;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:(null===(r=e.product)||void 0===r?void 0:r.name)||"N/A"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-500",children:(null===(n=e.product)||void 0===n?void 0:n.sku)||"N/A"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-500",children:(null===(s=e.product)||void 0===s?void 0:s.unit)||"N/A"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.quantity}),(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900",children:["₱",e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",children:["₱",(e.unit_price*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t)})})]})})]})]})]})})]})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let j=(0,i.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var w=r(2442);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let N=(0,i.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function BillingManager(e){var t;let{selectedBrand:r,theme:i="blue"}=e,[l,o]=(0,n.useState)([]),[c,x]=(0,n.useState)([]),[m,p]=(0,n.useState)(!1),[g,h]=(0,n.useState)(null),[y,f]=(0,n.useState)(!1),[v,k]=(0,n.useState)(0),[_,S]=(0,n.useState)("month");(0,n.useEffect)(()=>{r&&(fetchPaidOrders(),fetchReleasedOrders(),fetchTotalReceivable())},[r,_]),(0,n.useEffect)(()=>{if(!r)return;let e=s.O.channel("billing-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"customer_orders",filter:"brand_id=eq.".concat(r.id)},e=>{console.log("Billing orders realtime update:",e),("UPDATE"===e.eventType||"INSERT"===e.eventType||"DELETE"===e.eventType)&&(fetchPaidOrders(),fetchReleasedOrders(),fetchTotalReceivable())}).subscribe();return()=>{s.O.removeChannel(e)}},[r]);let getDateRange=()=>{let e,t;let r=new Date,a=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Manila",year:"numeric",month:"2-digit",day:"2-digit"}),n=a.formatToParts(r),s=parseInt(n.find(e=>"year"===e.type).value),i=parseInt(n.find(e=>"month"===e.type).value)-1,l=parseInt(n.find(e=>"day"===e.type).value);switch(_){case"day":default:e=new Date(s,i,l,0,0,0),t=new Date(s,i,l,23,59,59,999);break;case"week":let o=new Date(s,i,l-6);e=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0),t=new Date(s,i,l,23,59,59,999);break;case"month":e=new Date(s,i,1,0,0,0);let d=new Date(s,i+1,0).getDate();t=new Date(s,i,d,23,59,59,999);break;case"year":e=new Date(s,0,1,0,0,0),t=new Date(s,11,31,23,59,59,999)}return{start:e.toISOString(),end:t.toISOString()}},fetchPaidOrders=async()=>{if(r){p(!0);try{let{start:e,end:t}=getDateRange(),{data:a,error:n}=await s.O.from("customer_orders").select("\n          *,\n          location:locations(*),\n          brand:brands(*),\n          order_details(\n            *,\n            product:products(id, name, sku, unit, category)\n          )\n        ").eq("brand_id",r.id).in("status",["paid","complete"]).gte("created_at",e).lte("created_at",t).order("created_at",{ascending:!1});if(n){console.error("Error fetching paid orders:",n);return}a&&o(a)}catch(e){console.error("Error fetching paid orders:",e)}finally{p(!1)}}},fetchReleasedOrders=async()=>{if(r)try{let{data:e,error:t}=await s.O.from("customer_orders").select("\n          *,\n          location:locations(*),\n          brand:brands(*),\n          order_details(\n            *,\n            product:products(id, name, sku, unit, category)\n          )\n        ").eq("brand_id",r.id).eq("status","released").order("created_at",{ascending:!1});if(t)throw t;e&&x(e)}catch(e){console.error("Error fetching released orders:",e)}},fetchTotalReceivable=async()=>{if(r)try{let{data:e,error:t}=await s.O.from("customer_orders").select("total_amount").eq("brand_id",r.id).eq("status","released");if(t)throw t;let a=(null==e?void 0:e.reduce((e,t)=>e+(t.total_amount||0),0))||0;k(a)}catch(e){console.error("Error fetching receivables:",e)}},handleMarkComplete=async e=>{if(confirm("Are you sure you want to mark this order as complete?"))try{let{error:t}=await s.O.from("customer_orders").update({status:"complete",updated_at:new Date().toISOString()}).eq("id",e);if(t){console.error("Error updating order:",t),alert("Error updating order");return}o(t=>t.filter(t=>t.id!==e)),(null==g?void 0:g.id)===e&&(f(!1),h(null))}catch(e){console.error("Error updating order:",e),alert("Error updating order")}},handleViewDetails=e=>{h(e),f(!0)},getTotalItems=e=>{var t;return(null===(t=e.order_details)||void 0===t?void 0:t.reduce((e,t)=>e+t.quantity,0))||0},getSubtotalAmount=e=>{var t;return(null===(t=e.order_details)||void 0===t?void 0:t.reduce((e,t)=>e+t.unit_price*t.quantity,0))||0};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Billing Manager"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Track unpaid orders and manage paid orders by status"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Time Period:"}),(0,a.jsx)("div",{className:"flex space-x-2",children:["day","week","month","year"].map(e=>(0,a.jsx)("button",{onClick:()=>S(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(_===e?"green"===i?"bg-green-100 text-green-700 border border-green-300":"red"===i?"bg-red-100 text-red-700 border border-red-300":"yellow"===i?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-600 font-medium",children:"Total Revenue"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-900",children:["₱",l.reduce((e,t)=>e+(t.total_amount||0),0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("p",{className:"text-xs text-green-700 mt-1",children:[l.length," paid orders"]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Total Paid"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-blue-900",children:["₱",l.reduce((e,t)=>e+(t.total_amount||0),0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"Ready for completion"})]}),(0,a.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-orange-600 font-medium",children:"Total Receivable"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-orange-900",children:["₱",v.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("p",{className:"text-xs text-orange-700 mt-1",children:[c.length," unpaid orders"]})]})]})]}),c.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-orange-50",children:(0,a.jsx)("h4",{className:"text-lg font-medium text-orange-900",children:"Unpaid Orders (Receivable)"})}),(0,a.jsx)("div",{className:"overflow-x-auto overflow-y-visible",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-orange-50",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 align-middle",children:[e.id.slice(0,8),"..."]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 align-middle",children:(0,u.iI)(e.created_at,{dateStyle:"short"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 align-middle",children:(null===(t=e.location)||void 0===t?void 0:t.name)||"N/A"}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-orange-600 align-middle",children:["₱",e.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 align-middle",children:[getTotalItems(e)," items"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap align-middle",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:"Awaiting Payment"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 align-middle",children:(0,a.jsx)("div",{className:"flex space-x-2 items-center",children:(0,a.jsx)("button",{onClick:()=>handleViewDetails(e),className:"p-1 rounded text-blue-600 hover:text-blue-900 hover:bg-blue-50 transition-all duration-200 ease-in-out",title:"View Details",children:(0,a.jsx)(b,{className:"h-4 w-4"})})})})]},e.id)})})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-blue-50",children:(0,a.jsx)("h4",{className:"text-lg font-medium text-blue-900",children:"Paid & Completed Orders"})}),m?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===l.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Paid Orders"}),(0,a.jsx)("p",{className:"text-gray-600",children:"There are no paid or completed orders in the selected time period."})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 table-fixed",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Order ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Location"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-28",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Items"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Deposit Slip"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-blue-50",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 align-middle",children:[e.id.slice(0,8),"..."]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 align-middle",children:(0,u.iI)(e.created_at,{dateStyle:"short"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 align-middle",children:(null===(t=e.location)||void 0===t?void 0:t.name)||"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap align-middle",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("paid"===e.status?"bg-purple-100 text-purple-800":"complete"===e.status?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600 align-middle",children:["₱",e.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 align-middle",children:[getTotalItems(e)," items"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 align-middle",children:e.deposit_slip_url?(0,a.jsx)("a",{href:e.deposit_slip_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:"View"}):(0,a.jsx)("span",{className:"text-gray-400",children:"No slip"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 align-middle",children:(0,a.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,a.jsx)("button",{onClick:()=>handleViewDetails(e),className:"p-1 rounded text-blue-600 hover:text-blue-900 hover:bg-blue-50 transition-all duration-200 ease-in-out",title:"View Details",children:(0,a.jsx)(b,{className:"h-4 w-4"})}),"paid"===e.status&&(0,a.jsx)("button",{onClick:()=>handleMarkComplete(e.id),className:"p-1 rounded transition-all duration-200 ease-in-out ".concat("green"===i?"text-green-600 hover:text-green-900 hover:bg-green-50":"red"===i?"text-red-600 hover:text-red-900 hover:bg-red-50":"yellow"===i?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-50":"text-blue-600 hover:text-blue-900 hover:bg-blue-50"),title:"Mark Complete",children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})})]})})]},e.id)})})]})})]}),0===c.length&&0===l.length&&!m&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[(0,a.jsx)(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Billing Activity"}),(0,a.jsx)("p",{className:"text-gray-600",children:"There are no paid or unpaid orders to manage."})]}),y&&g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Order Details #",g.id.slice(0,8)]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)("button",{onClick:()=>{f(!1),h(null)},className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-6 w-6"})})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created Date"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:(0,u.iI)(g.created_at,{dateStyle:"short",timeStyle:"short"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat("paid"===g.status?"bg-purple-100 text-purple-800":"complete"===g.status?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-800"),children:g.status.charAt(0).toUpperCase()+g.status.slice(1)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Logistics"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat("delivery"===g.delivery_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"delivery"===g.delivery_type?"Delivery":"Pickup"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Location"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:(null===(t=g.location)||void 0===t?void 0:t.name)||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Amount"}),(0,a.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:["₱",g.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Category Totals"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(e=>{if(!e.order_details)return[];let t=new Map;return e.order_details.forEach(e=>{var r;console.log("Product data:",e.product);let a=(null===(r=e.product)||void 0===r?void 0:r.category)&&""!==e.product.category.trim()?e.product.category:"Uncategorized";t.has(a)||t.set(a,{category:a,totalQuantity:0,totalAmount:0});let n=t.get(a);n.totalQuantity+=e.quantity,n.totalAmount+=e.unit_price*e.quantity}),Array.from(t.values())})(g).map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded p-2 border text-center",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900",children:e.category}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[e.totalQuantity," items"]}),(0,a.jsxs)("p",{className:"text-xs font-semibold text-green-600",children:["₱",e.totalAmount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},t))})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Pricing Breakdown"}),(0,a.jsxs)("div",{className:"bg-white rounded p-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:["₱",getSubtotalAmount(g).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===g.delivery_type&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),getSubtotalAmount(g)>=1e4?(0,a.jsx)("span",{className:"text-sm text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-sm text-gray-900",children:"+₱500.00"})]}),"pickup"===g.delivery_type&&getSubtotalAmount(g)>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["-₱",(.05*getSubtotalAmount(g)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===g.delivery_type&&1e4>getSubtotalAmount(g)&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center border-t pt-2",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"text-sm font-semibold text-green-600",children:["₱",g.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})]})]}),g.deposit_slip_url&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center",children:[(0,a.jsx)(N,{className:"h-4 w-4 mr-2"}),"Deposit Slip"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("img",{src:g.deposit_slip_url,alt:"Deposit Slip",className:"w-20 h-20 object-cover rounded border"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Deposit slip uploaded"}),(0,a.jsxs)("a",{href:g.deposit_slip_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 hover:text-blue-800 text-sm mt-1",children:[(0,a.jsx)(b,{className:"h-3 w-3 mr-1"}),"View full size"]})]})]})]}),g.order_details&&g.order_details.length>0&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b",children:(0,a.jsxs)("h4",{className:"text-sm font-semibold text-gray-900",children:["Order Items (",g.order_details.length,")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.order_details.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.product.name}),e.product.sku&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["SKU: ",e.product.sku]})]})}),(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:[e.quantity," ",e.product.unit]}),(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["₱",e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["₱",(e.unit_price*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},e.id))})]})})]})]})]})})]})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let k=(0,i.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),_=(0,i.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),S=(0,i.Z)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),D=(0,i.Z)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);function LogisticsManager(e){let{selectedBrand:t,theme:r="blue"}=e,[i,l]=(0,n.useState)(new Date),[c,x]=(0,n.useState)([]),[m,u]=(0,n.useState)([]),[p,g]=(0,n.useState)(!1),[h,y]=(0,n.useState)({x:0,y:0}),[b,f]=(0,n.useState)(""),[v,j]=(0,n.useState)("morning"),[w,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(fetchAssignments(),fetchAvailableOrders())},[t,i]);let fetchAssignments=async()=>{if(t){N(!0);try{let e=new Date(i.getFullYear(),i.getMonth(),1),t=new Date(i.getFullYear(),i.getMonth()+1,0),{data:r,error:a}=await s.O.from("logistics_assignments").select("\n          *,\n           order:customer_orders(\n             id,\n             customer_name,\n             total_amount,\n             delivery_type,\n             created_at,\n             brand_id,\n             brand:brands(name),\n             location:locations(name)\n           )\n        ").gte("date",e.toISOString().split("T")[0]).lte("date",t.toISOString().split("T")[0]).order("date",{ascending:!0});if(a){console.error("Error fetching assignments:",a);return}x(r||[])}catch(e){console.error("Error fetching assignments:",e)}finally{N(!1)}}},fetchAvailableOrders=async()=>{if(t)try{let{data:e,error:r}=await s.O.from("customer_orders").select("\n           id,\n           customer_name,\n           total_amount,\n           delivery_type,\n           status,\n           created_at,\n           brand_id,\n           brand:brands(name),\n           location:locations(name)\n         ").eq("brand_id",t.id).in("status",["pending","approved","released","paid"]).order("created_at",{ascending:!1});if(r){console.error("Error fetching orders:",r);return}console.log("Fetched orders:",e),u(e||[])}catch(e){console.error("Error fetching orders:",e)}},handleCreateAssignment=async(e,t,r)=>{try{let{data:a,error:n}=await s.O.from("logistics_assignments").insert({order_id:e,date:t,time_slot:r,status:"scheduled",notes:null}).select();if(n){console.error("Error creating assignment:",n);return}await fetchAssignments()}catch(e){console.error("Error creating assignment:",e)}},handleDeleteAssignment=async e=>{if(confirm("Are you sure you want to delete this assignment?"))try{let{error:t}=await s.O.from("logistics_assignments").delete().eq("id",e);if(t){console.error("Error deleting assignment:",t);return}await fetchAssignments()}catch(e){console.error("Error deleting assignment:",e)}},getAssignmentsForDate=(e,t)=>c.filter(r=>r.date===e&&r.time_slot===t),getCalendarBrandColor=(e,t)=>{let r={mychoice:{morning:"bg-green-100 border-green-400",afternoon:"bg-green-100 border-green-400 border-l-4"},"mang sorbetes":{morning:"bg-yellow-100 border-yellow-400",afternoon:"bg-yellow-100 border-yellow-400 border-l-4"},gelatofilipino:{morning:"bg-red-100 border-red-400",afternoon:"bg-red-100 border-red-400 border-l-4"}},a=null==t?void 0:t.toLowerCase();if(a&&r[a])return console.log("Brand: ".concat(t," -> Custom color")),r[a];let n=t||e,s=0;for(let e=0;e<n.length;e++)s=(s<<5)-s+n.charCodeAt(e)&4294967295;let i=Math.abs(s)%3;switch(console.log("Brand: ".concat(t||e," -> Hash color (index: ").concat(i,")")),i){case 0:return{morning:"bg-blue-100 border-blue-400",afternoon:"bg-blue-100 border-blue-400 border-l-4"};case 1:return{morning:"bg-purple-100 border-purple-400",afternoon:"bg-purple-100 border-purple-400 border-l-4"};default:return{morning:"bg-gray-100 border-gray-400",afternoon:"bg-gray-100 border-gray-400 border-l-4"}}},navigateMonth=e=>{l(t=>{let r=new Date(t);return"prev"===e?r.setMonth(t.getMonth()-1):r.setMonth(t.getMonth()+1),r})},openOrderPopup=async(e,t,r)=>{f(t),j(r),y({x:e.clientX,y:e.clientY}),await fetchAssignments(),g(!0)},formatDate=e=>e.toISOString().split("T")[0],isToday=e=>{let t=new Date;return e.toDateString()===t.toDateString()},isPastDate=e=>{let t=new Date;t.setHours(0,0,0,0);let r=new Date(e);return r.setHours(0,0,0,0),r<t};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Logistics Manager"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Schedule and manage order deliveries"})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("button",{onClick:()=>navigateMonth("prev"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(k,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:i.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),(0,a.jsx)("button",{onClick:()=>navigateMonth("next"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(_,{className:"h-5 w-5 text-gray-600"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:"p-3 text-center text-sm font-medium text-gray-500 bg-gray-50 rounded-lg",children:e},e)),(()=>{let e=i.getFullYear(),t=i.getMonth(),r=new Date(e,t,1),a=new Date(e,t+1,0),n=a.getDate(),s=r.getDay(),l=[];for(let e=0;e<s;e++)l.push(null);for(let r=1;r<=n;r++)l.push(new Date(e,t,r));return l})().map((e,t)=>{if(!e)return(0,a.jsx)("div",{className:"p-3"},t);let r=formatDate(e),n=getAssignmentsForDate(r,"morning"),s=getAssignmentsForDate(r,"afternoon"),i=isToday(e),l=isPastDate(e);return(0,a.jsxs)("div",{className:"p-2 border rounded-lg min-h-[120px] ".concat(l?"bg-gray-100 border-gray-300 opacity-60":i?"bg-blue-50 border-blue-200":"bg-white border-gray-200"),children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900 mb-2",children:e.getDate()}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(S,{className:"h-3 w-3 text-yellow-500"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Morning"})]}),(0,a.jsx)("button",{onClick:e=>!l&&openOrderPopup(e,r,"morning"),disabled:l,className:"text-xs ".concat(l?"text-gray-400 cursor-not-allowed":"text-blue-600 hover:text-blue-800"),children:(0,a.jsx)(o.Z,{className:"h-3 w-3 text-gray-600"})})]}),(0,a.jsx)("div",{className:"space-y-1",children:n.map(e=>{var t,r,n,s,i,l;let o=getCalendarBrandColor((null===(t=e.order)||void 0===t?void 0:t.brand_id)||"",null===(n=e.order)||void 0===n?void 0:null===(r=n.brand)||void 0===r?void 0:r.name);return(0,a.jsxs)("div",{className:"text-xs p-1 ".concat(o.morning," rounded border-l-2 flex items-center justify-between group"),children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:null===(i=e.order)||void 0===i?void 0:null===(s=i.location)||void 0===s?void 0:s.name}),(0,a.jsx)("div",{className:"text-gray-600",children:(null===(l=e.order)||void 0===l?void 0:l.created_at)?new Date(e.order.created_at).toLocaleDateString():"No Date"})]}),(0,a.jsx)("button",{onClick:()=>handleDeleteAssignment(e.id),className:"ml-1 p-0.5 text-red-600 hover:text-red-800 hover:bg-red-200 rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove assignment",children:(0,a.jsx)(d.Z,{className:"h-3 w-3"})})]},e.id)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(D,{className:"h-3 w-3 text-blue-500"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Afternoon"})]}),(0,a.jsx)("button",{onClick:e=>!l&&openOrderPopup(e,r,"afternoon"),disabled:l,className:"text-xs ".concat(l?"text-gray-400 cursor-not-allowed":"text-blue-600 hover:text-blue-800"),children:(0,a.jsx)(o.Z,{className:"h-3 w-3 text-gray-600"})})]}),(0,a.jsx)("div",{className:"space-y-1",children:s.map(e=>{var t,r,n,s,i,l;let o=getCalendarBrandColor((null===(t=e.order)||void 0===t?void 0:t.brand_id)||"",null===(n=e.order)||void 0===n?void 0:null===(r=n.brand)||void 0===r?void 0:r.name);return(0,a.jsxs)("div",{className:"text-xs p-1 ".concat(o.afternoon," rounded border-l-2 flex items-center justify-between group"),children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:null===(i=e.order)||void 0===i?void 0:null===(s=i.location)||void 0===s?void 0:s.name}),(0,a.jsx)("div",{className:"text-gray-600",children:(null===(l=e.order)||void 0===l?void 0:l.created_at)?new Date(e.order.created_at).toLocaleDateString():"No Date"})]}),(0,a.jsx)("button",{onClick:()=>handleDeleteAssignment(e.id),className:"ml-1 p-0.5 text-red-600 hover:text-red-800 hover:bg-red-200 rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove assignment",children:(0,a.jsx)(d.Z,{className:"h-3 w-3"})})]},e.id)})})]})]},t)})]})]}),p&&(0,a.jsx)("div",{className:"fixed inset-0 z-50",onClick:()=>g(!1),children:(0,a.jsxs)("div",{className:"absolute bg-white border border-gray-300 rounded-lg shadow-lg p-4 max-w-sm max-h-80 overflow-y-auto",style:{left:Math.min(h.x,window.innerWidth-320),top:Math.min(h.y,window.innerHeight-200)},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-gray-900",children:["Select Order - ","morning"===v?"Morning":"Afternoon"]}),(0,a.jsx)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"space-y-2",children:(()=>{let e=c.map(e=>e.order_id),n=m.filter(t=>!e.includes(t.id));return console.log("Available orders:",m),console.log("All assignments:",c),console.log("Assigned order IDs:",e),console.log("Unassigned orders:",n),console.log("Selected brand:",t),0===n.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No available orders"}):n.map(e=>{var t,n;return(0,a.jsxs)("button",{onClick:()=>{handleCreateAssignment(e.id,b,v),g(!1)},className:"w-full text-left p-2 hover:bg-gray-100 rounded border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:null===(t=e.location)||void 0===t?void 0:t.name}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat((()=>{let e=r||"";return"green"===e?"bg-green-100 text-green-800":"red"===e?"bg-red-100 text-red-800":"yellow"===e?"bg-yellow-100 text-yellow-800":"blue"===e?"bg-blue-100 text-blue-800":"purple"===e?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"})()),children:(null===(n=e.brand)||void 0===n?void 0:n.name)||"Unknown"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[e.created_at?new Date(e.created_at).toLocaleDateString():"No Date"," - #",e.id.slice(-8)]})]},e.id)})})()})]})})]})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let P=(0,i.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),C=(0,i.Z)("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);var O=r(4322),F=r(6142);function DashboardPage(){let[e,t]=(0,n.useState)(!1),[r,s]=(0,n.useState)(""),[i,l]=(0,n.useState)(null),[o,d]=(0,n.useState)("products"),[c,x]=(0,n.useState)(""),[m,u]=(0,n.useState)(0),[p,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let initializeDashboard=async()=>{h(!0);let e=localStorage.getItem("dashboard_authenticated"),r=localStorage.getItem("dashboard_selected_brand"),a=localStorage.getItem("dashboard_active_tab");if("true"===e&&t(!0),r)try{l(JSON.parse(r))}catch(e){console.error("Error parsing saved brand:",e)}a&&["products","orders","branches","billing","logistics"].includes(a)&&d(a),setTimeout(()=>{h(!1)},800)};initializeDashboard()},[]),(0,n.useEffect)(()=>{i?localStorage.setItem("dashboard_selected_brand",JSON.stringify(i)):localStorage.removeItem("dashboard_selected_brand")},[i]),(0,n.useEffect)(()=>{localStorage.setItem("dashboard_active_tab",o)},[o]);let b=(e=>{if(!e)return"blue";switch(e.slug){case"mychoice":return"green";case"gelatofilipino":return"red";case"mang-sorbetes":return"yellow";default:return"blue"}})(i);return p?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-4 ".concat("green"===b?"bg-green-100":"red"===b?"bg-red-100":"yellow"===b?"bg-yellow-100":"bg-blue-100"),children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 ".concat("green"===b?"border-green-600":"red"===b?"border-red-600":"yellow"===b?"border-yellow-600":"border-blue-600")})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please wait while we check your session..."})]})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(O.Z,{className:"h-8 w-8 ".concat("green"===b?"text-green-600":"red"===b?"text-red-600":"yellow"===b?"text-yellow-600":"text-blue-600")}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"GFC Portal"}),i&&(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("green"===b?"bg-green-100 text-green-800":"red"===b?"bg-red-100 text-red-800":"yellow"===b?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:i.name})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{children:"Admin Access"})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("button",{onClick:()=>{t(!1),s(""),l(null),d("products"),h(!1),localStorage.removeItem("dashboard_authenticated"),localStorage.removeItem("dashboard_selected_brand"),localStorage.removeItem("dashboard_active_tab")},className:"flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,a.jsx)(P,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Logout"})]})})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,a.jsx)("div",{className:"flex-1 max-w-xs",children:(0,a.jsx)(BrandSelector,{onBrandChange:l})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>d("products"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("products"===o?"green"===b?"border-green-500 text-green-600":"red"===b?"border-red-500 text-red-600":"yellow"===b?"border-yellow-500 text-yellow-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(O.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Products & Inventory"})]})}),(0,a.jsx)("button",{onClick:()=>d("orders"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("orders"===o?"green"===b?"border-green-500 text-green-600":"red"===b?"border-red-500 text-red-600":"yellow"===b?"border-yellow-500 text-yellow-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Customer Orders"})]})}),(0,a.jsx)("button",{onClick:()=>d("branches"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("branches"===o?"green"===b?"border-green-500 text-green-600":"red"===b?"border-red-500 text-red-600":"yellow"===b?"border-yellow-500 text-yellow-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(F.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Branches"})]})}),(0,a.jsx)("button",{onClick:()=>d("billing"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("billing"===o?"green"===b?"border-green-500 text-green-600":"red"===b?"border-red-500 text-red-600":"yellow"===b?"border-yellow-500 text-yellow-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Billing"})]})}),(0,a.jsx)("button",{onClick:()=>d("logistics"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("logistics"===o?"green"===b?"border-green-500 text-green-600":"red"===b?"border-red-500 text-red-600":"yellow"===b?"border-yellow-500 text-yellow-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Logistics"})]})})]})})})]})})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:["products"===o&&i&&(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(ProductManager,{selectedBrand:i,theme:b},m)}),"orders"===o&&(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(OrderManager,{selectedBrand:i,onOrderUpdate:()=>{u(e=>e+1)},theme:b},m)}),"branches"===o&&i&&(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(BranchManager,{selectedBrand:i,theme:b},m)}),!i&&"branches"===o&&(0,a.jsxs)("div",{className:"p-6 text-center py-12",children:[(0,a.jsx)(F.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please select a brand to manage branches"})]}),"billing"===o&&i&&(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(BillingManager,{selectedBrand:i,theme:b},m)}),!i&&"billing"===o&&(0,a.jsxs)("div",{className:"p-6 text-center py-12",children:[(0,a.jsx)(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please select a brand to manage billing"})]}),"logistics"===o&&i&&(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(LogisticsManager,{selectedBrand:i,theme:b},m)}),!i&&"logistics"===o&&(0,a.jsxs)("div",{className:"p-6 text-center py-12",children:[(0,a.jsx)(g,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please select a brand to manage logistics"})]}),!i&&"products"===o&&(0,a.jsxs)("div",{className:"p-6 text-center py-12",children:[(0,a.jsx)(O.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please select a brand to manage products"})]})]})]})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center",children:[(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:(0,a.jsx)(P,{className:"h-6 w-6 text-blue-600"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Enter passcode to access inventory management"})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"john101797"===r?(t(!0),localStorage.setItem("dashboard_authenticated","true"),x("")):(x("Invalid passcode. Please try again."),s(""))},className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"passcode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Passcode"}),(0,a.jsx)("input",{type:"password",id:"passcode",value:r,onChange:e=>s(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-lg tracking-wider",placeholder:"Enter 6-digit passcode",maxLength:10,required:!0})]}),c&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,a.jsx)("p",{className:"text-red-800 text-sm",children:c})}),(0,a.jsxs)("button",{type:"submit",className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(C,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Access Dashboard"})]})]})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)("p",{className:"text-center text-xs text-gray-500",children:"\xa9 Gilnaks Food Corporation"})})]})}},2899:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var a=r(3082);let n=(0,a.createClientComponentClient)()},8939:function(e,t,r){"use strict";r.d(t,{iI:function(){return formatPhilippinesDateTime},sn:function(){return getPhilippinesDate}});let a="Asia/Manila";function toPhilippinesTime(e){let t=new Date(e),r=t.getTime()+6e4*t.getTimezoneOffset(),a=new Date(r+288e5);return a}function getPhilippinesDate(){let e=new Date;return e.toLocaleDateString("en-CA",{timeZone:a})}function formatPhilippinesDateTime(e,t){let r=toPhilippinesTime(e);return r.toLocaleString("en-US",{timeZone:a,...t})}}},function(e){e.O(0,[701,971,472,744],function(){return e(e.s=4264)}),_N_E=e.O()}]);