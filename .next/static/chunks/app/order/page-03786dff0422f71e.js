(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{9033:function(e,t,s){Promise.resolve().then(s.bind(s,8620))},8620:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return OrderPage}});var a=s(7437),n=s(2265),r=s(2899),i=s(6142),l=s(2442),o=s(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,o.Z)("IceCream",[["path",{d:"m7 11 4.08 10.35a1 1 0 0 0 1.84 0L17 11",key:"1v6356"}],["path",{d:"M17 7A5 5 0 0 0 7 7",key:"151p3v"}],["path",{d:"M17 7a2 2 0 0 1 0 4H7a2 2 0 0 1 0-4",key:"1sdaij"}]]),c=(0,o.Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),m=(0,o.Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),x=(0,o.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),u=(0,o.Z)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);var p=s(3505),g=s(9883);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,o.Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var b=s(2549),y=s(8501),f=s(8939);function OrderPage(){var e,t,s,o,v;let[j,w]=(0,n.useState)(!1),[N,k]=(0,n.useState)(""),[_,D]=(0,n.useState)(null),[S,P]=(0,n.useState)([]),[C,F]=(0,n.useState)([]),[O,q]=(0,n.useState)(null),[L,T]=(0,n.useState)([]),[A,H]=(0,n.useState)("home"),[z,E]=(0,n.useState)(!1),[M,I]=(0,n.useState)(!0),[Z,U]=(0,n.useState)(""),[R,B]=(0,n.useState)(""),[Y,V]=(0,n.useState)(!1),[Q,W]=(0,n.useState)(!1),[G,J]=(0,n.useState)(!1),[K,X]=(0,n.useState)(null),[$,ee]=(0,n.useState)("delivery");(0,n.useEffect)(()=>{let initializeApp=async()=>{I(!0);let e=localStorage.getItem("order_authenticated"),t=localStorage.getItem("order_location");if("true"===e&&t)try{let e=JSON.parse(t);D(e),w(!0),await Promise.all([checkPendingOrders(e.id),fetchPastOrders(e.id),fetchProducts(e.brand_id)])}catch(e){console.error("Error parsing saved data:",e),clearSession()}setTimeout(()=>{I(!1)},800)};initializeApp()},[]),(0,n.useEffect)(()=>{if(!_)return;let e=r.O.channel("order-updates").on("postgres_changes",{event:"*",schema:"public",table:"customer_orders",filter:"location_id=eq.".concat(_.id)},e=>{console.log("Order update received:",e),("UPDATE"===e.eventType||"INSERT"===e.eventType||"DELETE"===e.eventType)&&(checkPendingOrders(_.id),fetchPastOrders(_.id))}).subscribe();return()=>{r.O.removeChannel(e)}},[_]),(0,n.useEffect)(()=>{O&&"products"===A&&H("home")},[O,A]),(0,n.useEffect)(()=>{if(!(null==_?void 0:_.brand_id))return;let e=r.O.channel("order-products-changes").on("postgres_changes",{event:"*",schema:"public",table:"products",filter:"brand_id=eq.".concat(_.brand_id)},()=>{z||fetchProducts(_.brand_id)}).subscribe();return()=>{r.O.removeChannel(e)}},[null==_?void 0:_.brand_id,z]);let et=(e=>{if(!(null==e?void 0:e.brand))return"blue";switch(e.brand.slug){case"mychoice":return"green";case"gelatofilipino":return"red";case"mang-sorbetes":return"yellow";default:return"blue"}})(_),clearSession=()=>{w(!1),D(null),P([]),F([]),q(null),H("home"),U(""),B(""),I(!1),localStorage.removeItem("order_authenticated"),localStorage.removeItem("order_location"),localStorage.removeItem("order_cart_draft")},handleLocationAuth=async e=>{e.preventDefault(),E(!0),U("");try{let{data:e,error:t}=await r.O.from("locations").select("*, brand:brands(*)").eq("passkey",N).single();if(t)throw t;D(e),w(!0),localStorage.setItem("order_authenticated","true"),localStorage.setItem("order_location",JSON.stringify(e)),await Promise.all([checkPendingOrders(e.id),fetchPastOrders(e.id),fetchProducts(e.brand_id)])}catch(e){U("Invalid location passcode. Please try again."),k("")}finally{E(!1)}},fetchProducts=async e=>{try{let{data:t,error:s}=await r.O.from("inventory_summary").select("*").eq("brand_id",e).order("category, product_name");if(s)throw s;P(t||[])}catch(e){console.error("Error fetching products:",e)}},checkPendingOrders=async e=>{try{let{data:t,error:s}=await r.O.from("customer_orders").select("\n          id, status, created_at, total_amount, delivery_type, deposit_slip_url,\n          order_details (\n            id, product_id, quantity, unit_price,\n            products (id, name, price, unit, category)\n          )\n        ").eq("location_id",e).in("status",["pending","approved","released","paid"]).order("created_at",{ascending:!1}).limit(1);if(s)throw s;t&&t.length>0?q(t[0]):q(null)}catch(e){console.error("Error checking pending orders:",e)}},fetchPastOrders=async e=>{try{let{data:t,error:s}=await r.O.from("customer_orders").select("\n          id, status, created_at, total_amount, delivery_type, deposit_slip_url,\n          order_details (\n            id, product_id, quantity, unit_price,\n            products (id, name, price, unit, category)\n          )\n        ").eq("location_id",e).in("status",["released","paid","complete","cancelled"]).order("created_at",{ascending:!1});if(s)throw s;T(t||[])}catch(e){console.error("Error fetching past orders:",e)}},getAvailableStock=e=>e.available_stock||0,getCartItemAvailableStock=e=>{let t=S.find(t=>(t.product_id||t.id)===e.product_id);if(t){if("modify"===A&&O){var s;let a=null===(s=O.order_details)||void 0===s?void 0:s.find(t=>t.product_id===e.product_id);if(a)return(t.available_stock||0)+a.quantity}return t.available_stock||0}return getAvailableStock(e.product)},addToCart=e=>{let t=e.product_id||e.id,s=C.find(e=>e.product_id===t);s?F(e=>e.map(e=>e.product_id===t?{...e,quantity:e.quantity+1}:e)):F(s=>[...s,{product_id:t,quantity:1,product:e}])},updateCartQuantity=(e,t)=>{t<=0?F(t=>t.filter(t=>t.product_id!==e)):F(s=>s.map(s=>s.product_id===e?{...s,quantity:t}:s))},removeFromCart=e=>{F(t=>t.filter(t=>t.product_id!==e))},calculateTotal=()=>{let e=C.reduce((e,t)=>e+(t.product.price||0)*t.quantity,0);return"delivery"===$?e>=1e4?e:e+500:e>=1e4?.95*e:e},calculateSubtotal=()=>C.reduce((e,t)=>e+(t.product.price||0)*t.quantity,0),calculateItemCount=()=>C.reduce((e,t)=>e+t.quantity,0),getProductsByCategory=()=>{let e=S.reduce((e,t)=>{let s=t.category||"Other";return e[s]||(e[s]=[]),e[s].push(t),e},{});Object.keys(e).forEach(t=>{e[t].sort((e,t)=>{let s=(e.product_name||e.name||"").toLowerCase(),a=(t.product_name||t.name||"").toLowerCase();return s.localeCompare(a)})});let t={},s=Object.keys(e).sort((e,t)=>"Other"===e?1:"Other"===t?-1:e.toLowerCase().localeCompare(t.toLowerCase()));return s.forEach(s=>{t[s]=e[s]}),t},validateStockAvailability=async()=>{let e=[];if(null==_?void 0:_.brand_id)try{let{data:s,error:a}=await r.O.from("inventory_summary").select("*").eq("brand_id",_.brand_id);if(a)throw a;P(s||[]);let n=C.map(e=>{let t=null==s?void 0:s.find(t=>(t.product_id||t.id)===e.product_id);return t?{...e,product:t}:e});for(let a of(F(n),n)){let n=null==s?void 0:s.find(e=>(e.product_id||e.id)===a.product_id);if(n){let s=n.available_stock||0;if("modify"===A&&O){var t;let e=null===(t=O.order_details)||void 0===t?void 0:t.find(e=>e.product_id===a.product_id);e&&(s+=e.quantity)}a.quantity>s&&e.push("".concat(n.product_name||n.name,": Requested ").concat(a.quantity,", Available ").concat(s))}}}catch(t){for(let s of(console.error("Error fetching fresh product data:",t),C)){let t=getCartItemAvailableStock(s);s.quantity>t&&e.push("".concat(s.product.product_name||s.product.name,": Requested ").concat(s.quantity,", Available ").concat(t))}}return e},handleSubmitOrder=async()=>{if(!_||0===C.length){U("Please add items to your order.");return}let e=await validateStockAvailability();if(e.length>0){U("Insufficient stock for the following items:\n".concat(e.join("\n")));return}E(!0),U("");try{for(let e of C){let{error:t}=await r.O.from("products").update({reserved:(e.product.reserved||0)+e.quantity,updated_at:new Date().toISOString()}).eq("id",e.product_id);if(t)throw t}let e=calculateTotal(),{data:t,error:s}=await r.O.from("customer_orders").insert([{location_id:_.id,brand_id:_.brand_id,customer_name:"".concat(_.name," Order"),status:"pending",total_amount:e,delivery_type:$}]).select();if(s)throw s;let a=C.map(e=>({order_id:t[0].id,product_id:e.product_id,quantity:e.quantity,unit_price:e.product.price||0})),{error:n}=await r.O.from("order_details").insert(a);if(n)throw n;B("Order submitted successfully!"),F([]),await checkPendingOrders(_.id),H("home"),W(!1)}catch(e){console.error("Error submitting order:",e),U("Failed to submit order. Please try again.")}finally{E(!1)}},handleUpdateOrder=async()=>{if(!O||0===C.length)return;let e=await validateStockAvailability();if(e.length>0){U("Insufficient stock for the following items:\n".concat(e.join("\n")));return}E(!0),U("");try{var t;let e=new Set([...(null===(t=O.order_details)||void 0===t?void 0:t.map(e=>e.product_id))||[],...C.map(e=>e.product_id)]),{data:s,error:a}=await r.O.from("products").select("id, reserved").in("id",Array.from(e));if(a)throw a;let n=new Map((null==s?void 0:s.map(e=>[e.id,e.reserved||0]))||[]),i=new Map;if(O.order_details)for(let e of O.order_details){let t=e.quantity,s=C.find(t=>t.product_id===e.product_id),a=s?s.quantity:0,n=a-t;i.set(e.product_id,n)}for(let e of C)i.has(e.product_id)||i.set(e.product_id,e.quantity);for(let[e,t]of Array.from(i.entries()))if(0!==t){let s=n.get(e)||0,a=Math.max(0,s+t),{error:i}=await r.O.from("products").update({reserved:a,updated_at:new Date().toISOString()}).eq("id",e);if(i)throw i}await r.O.from("order_details").delete().eq("order_id",O.id);let l=C.map(e=>({order_id:O.id,product_id:e.product_id,quantity:e.quantity,unit_price:e.product.price||0}));await r.O.from("order_details").insert(l);let o=calculateTotal();await r.O.from("customer_orders").update({total_amount:o,delivery_type:$}).eq("id",O.id),B("Order updated successfully!"),F([]),await checkPendingOrders(_.id),H("home"),W(!1)}catch(e){console.error("Error updating order:",e),U("Failed to update order. Please try again.")}finally{E(!1)}},getTotalAmount=e=>e.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0),handlePhotoUpload=async(e,t)=>{J(!0),X(e);try{let s=t.name.split(".").pop(),a="".concat(e,"_").concat(Date.now(),".").concat(s),{data:n,error:i}=await r.O.storage.from("deposit-slips").upload(a,t);if(i)throw i;let{data:{publicUrl:l}}=r.O.storage.from("deposit-slips").getPublicUrl(a),{error:o}=await r.O.from("customer_orders").update({deposit_slip_url:l,status:"paid",updated_at:new Date().toISOString()}).eq("id",e);if(o)throw o;B("Deposit slip uploaded successfully! Order status updated to Paid."),_&&await Promise.all([checkPendingOrders(_.id),fetchPastOrders(_.id)])}catch(e){console.error("Error uploading photo:",e),U("Failed to upload deposit slip. Please try again.")}finally{J(!1),X(null)}},printReceipt=e=>{let t=window.open("","_blank");if(t){var s,a,n;t.document.write("\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>Receipt - Order ".concat(e.id.slice(0,8),"</title>\n          <style>\n            \n            * { box-sizing: border-box; }\n            body { \n              font-family: Arial, sans-serif; \n              margin: 0; \n              padding: 10px; \n              background: white;\n              color: black;\n              line-height: 1.4;\n            }\n            \n            .receipt-container {\n              max-width: 100%;\n              width: 100%;\n              margin: 0;\n              background: white;\n              box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n              border-radius: 12px;\n              overflow: hidden;\n              display: flex;\n              flex-direction: column;\n              min-height: 100vh;\n              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            }\n            \n            .header { \n              text-align: center; \n              padding: 24px 20px;\n              background: ").concat("green"===et?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"red"===et?"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)":"yellow"===et?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",';\n              color: white;\n              border-bottom: none;\n            }\n            \n            .company-name { \n              font-size: 26px; \n              font-weight: 700; \n              margin-bottom: 6px;\n              color: white;\n              letter-spacing: 0.025em;\n            }\n            \n            .receipt-title { \n              font-size: 16px; \n              font-weight: 400; \n              color: rgba(255, 255, 255, 0.9);\n              text-transform: uppercase;\n              letter-spacing: 0.05em;\n            }\n            \n            .order-info { \n              padding: 16px 20px; \n              background: #f8fafc;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            \n            .info-grid {\n              display: grid;\n              grid-template-columns: 1fr 1fr 1fr 1fr 1fr;\n              gap: 12px 16px;\n            }\n            \n            .info-item {\n              display: flex;\n              flex-direction: column;\n              text-align: center;\n            }\n            \n            .info-label { \n              font-weight: 600; \n              color: #6b7280;\n              font-size: 11px;\n              text-transform: uppercase;\n              margin-bottom: 4px;\n              letter-spacing: 0.025em;\n            }\n            \n            .info-value { \n              font-weight: 600; \n              color: #111827;\n              font-size: 13px;\n            }\n            \n            .status-badge {\n              display: inline-block;\n              padding: 2px 6px;\n              border: 1px solid black;\n              font-size: 11px;\n              font-weight: normal;\n              text-transform: uppercase;\n            }\n            \n            .status-pending { background: white; color: black; }\n            .status-approved { background: white; color: black; }\n            .status-released { background: black; color: white; }\n            .status-cancelled { background: white; color: black; }\n            \n            .items { \n              padding: 16px 20px;\n              flex: 1;\n              background: white;\n            }\n            \n            .items-title {\n              font-size: 14px;\n              font-weight: 700;\n              margin-bottom: 12px;\n              color: #111827;\n              text-transform: uppercase;\n              letter-spacing: 0.025em;\n            }\n            \n            .items-header {\n              display: grid;\n              grid-template-columns: 2fr 1fr 1fr 1fr;\n              gap: 12px;\n              padding: 8px 0;\n              border-bottom: 2px solid #e5e7eb;\n              margin-bottom: 8px;\n              background: #f9fafb;\n            }\n            \n            .header-cell {\n              font-size: 12px;\n              font-weight: 600;\n              color: #374151;\n              text-transform: uppercase;\n              letter-spacing: 0.025em;\n            }\n            \n            .header-item { text-align: left; }\n            .header-qty { text-align: center; }\n            .header-price { text-align: center; }\n            .header-total { text-align: right; }\n            \n            .item-row {\n              display: grid;\n              grid-template-columns: 2fr 1fr 1fr 1fr;\n              gap: 12px;\n              align-items: center;\n              padding: 8px 0;\n              border-bottom: 1px solid #f3f4f6;\n            }\n            \n            .item-row:last-child {\n              border-bottom: none;\n            }\n            \n            .item-name {\n              font-weight: normal;\n              color: black;\n              margin-bottom: 1px;\n              font-size: 12px;\n            }\n            \n            .item-details {\n              font-size: 10px;\n              color: #666;\n            }\n            \n            .item-quantity {\n              text-align: center;\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .item-unit-price {\n              text-align: center;\n              font-weight: normal;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .item-price {\n              text-align: right;\n              font-weight: bold;\n              color: black;\n              font-size: 12px;\n            }\n            \n            .category-summary {\n              padding: 12px 16px;\n              background: #f8fafc;\n              border-top: 1px solid #e2e8f0;\n              margin-bottom: 8px;\n            }\n            \n            .category-title {\n              font-size: 13px;\n              font-weight: 600;\n              color: #374151;\n              margin-bottom: 8px;\n              text-transform: uppercase;\n              letter-spacing: 0.025em;\n            }\n            \n            .category-row {\n              display: grid;\n              grid-template-columns: 2fr 1fr 1fr;\n              gap: 8px;\n              align-items: center;\n              padding: 4px 0;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            \n            .category-row:last-child {\n              border-bottom: none;\n            }\n            \n            .category-label {\n              font-size: 12px;\n              color: #374151;\n              font-weight: 500;\n            }\n            \n            .category-quantity {\n              font-size: 11px;\n              color: #6b7280;\n              text-align: center;\n            }\n            \n            .category-amount {\n              font-size: 12px;\n              color: #374151;\n              font-weight: 600;\n              text-align: right;\n            }\n            \n            .total-section { \n              padding: 12px 16px;\n              background: white;\n              border-top: 2px solid #e2e8f0;\n            }\n            \n            .total-row {\n              display: flex;\n              justify-content: space-between;\n              align-items: center;\n              margin-bottom: 6px;\n              padding: 2px 0;\n            }\n            \n            .total-label {\n              font-weight: 500;\n              color: #374151;\n              font-size: 12px;\n            }\n            \n            .total-value {\n              font-weight: 600;\n              color: #374151;\n              font-size: 12px;\n            }\n            \n            .grand-total {\n              border-top: 2px solid #374151;\n              padding-top: 8px;\n              margin-top: 8px;\n              font-weight: 700;\n            }\n            \n            .grand-total .total-label {\n              font-size: 14px;\n              font-weight: 700;\n              color: #111827;\n            }\n            \n            .grand-total .total-value {\n              font-size: 14px;\n              font-weight: 700;\n              color: #111827;\n            }\n            \n            .footer { \n              text-align: center; \n              padding: 16px 20px;\n              background: #f8fafc;\n              color: #6b7280;\n              margin-top: auto;\n              border-top: 1px solid #e2e8f0;\n            }\n            \n            .footer-text {\n              font-size: 13px;\n              margin-bottom: 4px;\n              font-weight: 600;\n              color: #374151;\n            }\n            \n            .footer-date {\n              font-size: 11px;\n              color: #6b7280;\n            }\n            \n            .notes {\n              padding: 12px 16px;\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              margin: 8px 16px;\n              border-radius: 6px;\n            }\n            \n            .notes-title {\n              font-weight: 600;\n              color: #92400e;\n              margin-bottom: 4px;\n              font-size: 12px;\n              text-transform: uppercase;\n              letter-spacing: 0.025em;\n            }\n            \n            .notes-text {\n              color: #78350f;\n              font-size: 12px;\n              line-height: 1.4;\n            }\n            \n            @media print { \n              body { margin: 0; padding: 0; }\n              .receipt-container { box-shadow: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="receipt-container">\n            <div class="header">\n              <div class="company-name">').concat((null===(s=e.brand)||void 0===s?void 0:s.name)||(null==_?void 0:null===(a=_.brand)||void 0===a?void 0:a.name)||"GFC",'</div>\n              <div class="receipt-title">Order Receipt</div>\n            </div>\n            \n            <div class="order-info">\n              <div class="info-grid">\n                <div class="info-item">\n                  <span class="info-label">Order ID</span>\n                  <span class="info-value">').concat(e.id.slice(0,8),'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Date</span>\n                  <span class="info-value">').concat((0,f.iI)(e.created_at,{dateStyle:"short"}),'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Location</span>\n                  <span class="info-value">').concat((null===(n=e.location)||void 0===n?void 0:n.name)||(null==_?void 0:_.name)||"N/A",'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Logistics</span>\n                  <span class="info-value">').concat("delivery"===e.delivery_type?"Delivery":"Pickup",'</span>\n                </div>\n                <div class="info-item">\n                  <span class="info-label">Status</span>\n                  <span class="info-value">').concat(e.status,'</span>\n                </div>\n              </div>\n            </div>\n            \n            <div class="items">\n              <div class="items-header">\n                <div class="header-cell header-item">Item</div>\n                <div class="header-cell header-qty">Quantity</div>\n                <div class="header-cell header-price">Unit Price</div>\n                <div class="header-cell header-total">Total</div>\n              </div>\n              ').concat(e.order_details.map(e=>{var t,s,a,n,r,i,l,o;return'\n                <div class="item-row">\n                  <div>\n                    <div class="item-name">'.concat((null===(t=e.product)||void 0===t?void 0:t.name)||(null===(s=e.products)||void 0===s?void 0:s.name),'</div>\n                    <div class="item-details">\n                      ').concat((null===(a=e.product)||void 0===a?void 0:a.sku)||(null===(n=e.products)||void 0===n?void 0:n.sku)?"SKU: ".concat((null===(r=e.product)||void 0===r?void 0:r.sku)||(null===(i=e.products)||void 0===i?void 0:i.sku)):"",'\n                    </div>\n                  </div>\n                  <div class="item-quantity">').concat(e.quantity," ").concat((null===(l=e.product)||void 0===l?void 0:l.unit)||(null===(o=e.products)||void 0===o?void 0:o.unit),'</div>\n                  <div class="item-unit-price">₱').concat(e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),'</div>\n                  <div class="item-price">₱').concat((e.unit_price*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</div>\n                </div>\n              ")}).join(""),"\n            </div>\n            \n            ").concat(e.notes?'\n              <div class="notes">\n                <div class="notes-title">Notes</div>\n                <div class="notes-text">'.concat(e.notes,"</div>\n              </div>\n            "):"",'\n            \n            <div class="category-summary">\n              ').concat((()=>{let t={};return e.order_details.forEach(e=>{var s,a;let n=(null===(s=e.product)||void 0===s?void 0:s.category)||(null===(a=e.products)||void 0===a?void 0:a.category)||"General";t[n]||(t[n]={quantity:0,amount:0}),t[n].quantity+=e.quantity,t[n].amount+=e.unit_price*e.quantity}),Object.entries(t).map(e=>{let[t,s]=e;return'\n                  <div class="category-row">\n                    <span class="category-label">'.concat(t,'</span>\n                    <span class="category-quantity">').concat(s.quantity,' items</span>\n                    <span class="category-amount">₱').concat(s.amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                  </div>\n                ")}).join("")})(),'\n            </div>\n            \n            <div class="total-section">\n              ').concat((()=>{let t=e.order_details.reduce((e,t)=>e+t.unit_price*t.quantity,0),s=0,a=t;return"delivery"===e.delivery_type?t<1e4&&(a=t+500):"pickup"===e.delivery_type&&t>=1e4&&(s=.05*t,a=t-s),'\n                  <div class="total-row">\n                    <span class="total-label">Subtotal</span>\n                    <span class="total-value">₱'.concat(t.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                  </div>\n                  ").concat("delivery"===e.delivery_type?'\n                    <div class="total-row">\n                      <span class="total-label">Delivery Fee</span>\n                      <span class="total-value">'.concat(t>=1e4?"FREE (Order over ₱10k)":"+₱500.00","</span>\n                    </div>\n                  "):"","\n                  ").concat("pickup"===e.delivery_type&&t>=1e4?'\n                    <div class="total-row">\n                      <span class="total-label">Pickup Discount (5%)</span>\n                      <span class="total-value">-₱'.concat(s.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                    </div>\n                  "):"","\n                  ").concat("pickup"===e.delivery_type&&t<1e4?'\n                    <div class="total-row">\n                      <span class="total-label">Pickup Discount</span>\n                      <span class="total-value">Not available (Order under ₱10k)</span>\n                    </div>\n                  ':"",'\n                  <div class="total-row grand-total">\n                    <span class="total-label">Total Amount</span>\n                    <span class="total-value">₱').concat(a.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),"</span>\n                  </div>\n                ")})(),'\n            </div>\n            \n            <div class="footer">\n              <div class="footer-text">Thank you for your order!</div>\n              <div class="footer-date">Generated on ').concat(new Date().toLocaleString(),"</div>\n            </div>\n          </div>\n        </body>\n        </html>\n      ")),t.document.close(),t.focus(),t.print(),t.close()}};return M?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-4 ".concat("green"===et?"bg-green-100":"red"===et?"bg-red-100":"yellow"===et?"bg-yellow-100":"bg-blue-100"),children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 ".concat("green"===et?"border-green-600":"red"===et?"border-red-600":"yellow"===et?"border-yellow-600":"border-blue-600")})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Order System"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please wait while we check your session..."})]})}):j?R?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-8 text-center",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full mb-4 ".concat("green"===et?"bg-green-100":"red"===et?"bg-red-100":"yellow"===et?"bg-yellow-100":"bg-blue-100"),children:(0,a.jsx)(l.Z,{className:"h-6 w-6 ".concat("green"===et?"text-green-600":"red"===et?"text-red-600":"yellow"===et?"text-yellow-600":"text-blue-600")})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Success!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:R}),(0,a.jsx)("button",{onClick:()=>{B(""),H("home")},className:"w-full px-4 py-3 text-white rounded-lg transition-colors ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Continue"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4 min-w-0 flex-1",children:[(0,a.jsx)(d,{className:"h-6 w-6 sm:h-8 sm:w-8 flex-shrink-0 ".concat("green"===et?"text-green-600":"red"===et?"text-red-600":"yellow"===et?"text-yellow-600":"text-blue-600")}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h1",{className:"text-lg sm:text-2xl font-bold text-gray-900 truncate",children:(null==_?void 0:null===(e=_.brand)||void 0===e?void 0:e.name)||"Order System"}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 flex items-center",children:[(0,a.jsx)(i.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:null==_?void 0:_.name})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2 flex-shrink-0",children:["home"!==A&&(0,a.jsxs)("button",{onClick:()=>H("home"),className:"flex items-center space-x-1 px-2 sm:px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors text-xs sm:text-sm",children:[(0,a.jsx)(c,{className:"h-3 w-3 sm:h-4 sm:w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Home"})]}),(0,a.jsxs)("button",{onClick:()=>V(!0),className:"flex items-center space-x-1 px-2 sm:px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors text-xs sm:text-sm",children:[(0,a.jsx)(m,{className:"h-3 w-3 sm:h-4 sm:w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Past Orders"})]}),(0,a.jsxs)("button",{onClick:clearSession,className:"flex items-center space-x-1 px-2 sm:px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors text-xs sm:text-sm",children:[(0,a.jsx)(x,{className:"h-3 w-3 sm:h-4 sm:w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Logout"})]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 py-4 sm:py-8",children:["home"===A&&(0,a.jsxs)("div",{className:"space-y-6",children:[Z&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-800 whitespace-pre-line",children:Z})}),O?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg mb-6 ".concat("approved"===O.status?"bg-green-50 border border-green-200":"released"===O.status?"bg-orange-50 border border-orange-200":"paid"===O.status?"bg-blue-50 border border-blue-200":"bg-yellow-50 border border-yellow-200"),children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:"approved"===O.status?(0,a.jsx)(l.Z,{className:"h-5 w-5 text-green-400"}):"released"===O.status?(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-orange-400"}):"paid"===O.status?(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-blue-400"}):(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-yellow-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium ".concat("approved"===O.status?"text-green-800":"released"===O.status?"text-orange-800":"paid"===O.status?"text-blue-800":"text-yellow-800"),children:"approved"===O.status?"Order Approved":"released"===O.status?"Order Released":"paid"===O.status?"Payment Received":"Pending Order"}),(0,a.jsx)("p",{className:"text-sm ".concat("approved"===O.status?"text-green-700":"released"===O.status?"text-orange-700":"paid"===O.status?"text-blue-700":"text-yellow-700"),children:"approved"===O.status?"Your order has been approved and is being processed.":"released"===O.status?"Your order has been released. Please complete payment to proceed.":"paid"===O.status?"Payment received. Your order is being prepared for completion.":"Your order is pending approval. You can modify it if needed."})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["₱",(null===(t=O.total_amount)||void 0===t?void 0:t.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Order #",O.id.slice(-8)]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Order Items"}),null===(s=O.order_details)||void 0===s?void 0:s.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.products.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["₱",e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})," per ",e.products.unit]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900",children:[e.quantity," ",e.products.unit]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["₱",(e.quantity*e.unit_price).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]},e.id)),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["₱",getTotalAmount(O).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===O.delivery_type&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),getTotalAmount(O)>=1e4?(0,a.jsx)("span",{className:"text-sm text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"+₱500.00"})]}),"pickup"===O.delivery_type&&getTotalAmount(O)>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["-₱",(.05*getTotalAmount(O)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===O.delivery_type&&1e4>getTotalAmount(O)&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center border-t pt-2",children:[(0,a.jsx)("span",{className:"font-medium text-base",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600 text-lg",children:["₱",(null===(o=O.total_amount)||void 0===o?void 0:o.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"]})]})]})})]}),(0,a.jsxs)("div",{className:"mt-6 flex space-x-4",children:["pending"===O.status&&(0,a.jsxs)("button",{onClick:()=>{if((null==O?void 0:O.order_details)&&"pending"===O.status){let e=O.order_details.map(e=>({product_id:e.product_id,quantity:e.quantity,product:e.products}));F(e),ee(O.delivery_type||"delivery"),H("modify")}},className:"flex items-center space-x-2 px-6 py-3 text-white rounded-lg transition-colors ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(u,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Modify Order"})]}),"released"===O.status&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 w-full",children:[(0,a.jsx)("div",{className:"text-center sm:text-left",children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Your order has been released. Please upload your deposit slip to complete payment."})}),(0,a.jsxs)("div",{className:"flex justify-center sm:justify-end gap-2",children:[O.deposit_slip_url&&(0,a.jsxs)("button",{onClick:()=>window.open(O.deposit_slip_url,"_blank"),className:"flex items-center space-x-2 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors min-h-[44px] sm:min-h-0 w-full sm:w-auto justify-center",children:[(0,a.jsxs)("svg",{className:"h-4 w-4 sm:h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,a.jsx)("span",{className:"text-sm sm:text-base",children:"View"})]}),(0,a.jsx)("input",{type:"file",id:"deposit-slip-upload",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&handlePhotoUpload(O.id,s)},className:"hidden",disabled:G&&K===O.id}),(0,a.jsx)("label",{htmlFor:"deposit-slip-upload",className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors cursor-pointer min-h-[44px] sm:min-h-0 w-full sm:w-auto justify-center ".concat(G&&K===O.id?"bg-gray-400 cursor-not-allowed":"green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:G&&K===O.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 w-5 border-b-2 border-white"}),(0,a.jsx)("span",{className:"text-sm sm:text-base",children:"Uploading..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"h-4 w-4 sm:h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,a.jsx)("span",{className:"text-sm sm:text-base",children:"Upload Deposit Slip"})]})})]})]}),"approved"===O.status&&(0,a.jsx)("div",{className:"text-center w-full",children:(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"You have an approved order. Please wait for it to be processed before creating a new order."})}),"paid"===O.status&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 w-full",children:[(0,a.jsx)("div",{className:"text-center sm:text-left",children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Payment received. Your order is being prepared for completion."})}),(0,a.jsxs)("div",{className:"flex justify-center sm:justify-end gap-2",children:[O.deposit_slip_url&&(0,a.jsxs)("button",{onClick:()=>window.open(O.deposit_slip_url,"_blank"),className:"flex items-center space-x-2 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors min-h-[44px] sm:min-h-0 w-full sm:w-auto justify-center",children:[(0,a.jsxs)("svg",{className:"h-4 w-4 sm:h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,a.jsx)("span",{className:"text-sm sm:text-base",children:"View"})]}),(0,a.jsx)("input",{type:"file",id:"deposit-slip-reupload",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&handlePhotoUpload(O.id,s)},className:"hidden",disabled:G&&K===O.id}),(0,a.jsx)("label",{htmlFor:"deposit-slip-reupload",className:"flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition-colors cursor-pointer min-h-[44px] sm:min-h-0 w-full sm:w-auto justify-center ".concat(G&&K===O.id?"bg-gray-400 cursor-not-allowed":"green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:G&&K===O.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 w-5 border-b-2 border-white"}),(0,a.jsx)("span",{className:"text-sm sm:text-base",children:"Uploading..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"h-4 w-4 sm:h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,a.jsx)("span",{className:"text-sm sm:text-base",children:"Re-upload Deposit Slip"})]})})]})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[L.filter(e=>"released"===e.status).length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Outstanding Balance"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[L.filter(e=>"released"===e.status).length," order(s)"]})]}),L.filter(e=>"released"===e.status).map(e=>(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-orange-900",children:["Order #",e.id.slice(-8)]}),(0,a.jsxs)("p",{className:"text-sm text-orange-700",children:["Released on ",new Date(e.created_at).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-orange-900",children:["₱",e.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("p",{className:"text-sm text-orange-700",children:"Balance Due"})]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{className:"text-sm text-orange-700",children:[(0,a.jsx)("p",{children:"Please upload your deposit slip to complete payment"}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-orange-600",children:["delivery"===e.delivery_type?"Delivery Order":"Pickup Order",getTotalAmount(e)>=1e4&&"delivery"===e.delivery_type&&" • Free delivery (Order over ₱10k)",getTotalAmount(e)>=1e4&&"pickup"===e.delivery_type&&" • 5% discount applied"]})]}),(0,a.jsxs)("label",{className:"flex items-center justify-center space-x-2 px-3 py-2 sm:px-4 sm:py-2 text-white rounded-lg transition-colors cursor-pointer w-full sm:w-auto min-h-[44px] sm:min-h-0 ".concat("green"===et?"bg-green-600 hover:bg-green-700 active:bg-green-800":"red"===et?"bg-red-600 hover:bg-red-700 active:bg-red-800":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700 active:bg-yellow-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"),children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:t=>{var s;let a=null===(s=t.target.files)||void 0===s?void 0:s[0];a&&handlePhotoUpload(e.id,a)},className:"hidden",disabled:G&&K===e.id}),G&&K===e.id?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b-2 border-white"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"h-4 w-4 sm:h-5 sm:w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Upload Deposit Slip"})]})]})]})]},e.id))]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[(0,a.jsx)(p.Z,{className:"mx-auto h-16 w-16 mb-4 ".concat("green"===et?"text-green-400":"red"===et?"text-red-400":"yellow"===et?"text-yellow-400":"text-blue-400")}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Pending Orders"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"You can start a new order by clicking the button below."}),(0,a.jsxs)("button",{onClick:()=>{O||H("products")},className:"flex items-center space-x-2 px-6 py-3 text-white rounded-lg transition-colors mx-auto ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(g.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Start New Order"})]})]})]})]}),"products"===A&&!O&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2 min-w-0",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-3 sm:p-6",children:[(0,a.jsxs)("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 truncate",children:[null==_?void 0:null===(v=_.brand)||void 0===v?void 0:v.name," Products"]}),(0,a.jsx)("div",{className:"space-y-6",children:Object.entries(getProductsByCategory()).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold mb-3 px-4 py-3 border-l-4 rounded-r-md ".concat("green"===et?"border-green-500 bg-green-100 text-green-800":"red"===et?"border-red-500 bg-red-100 text-red-800":"yellow"===et?"border-yellow-500 bg-yellow-100 text-yellow-800":"border-blue-500 bg-blue-100 text-blue-800"),children:t}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:s.map(e=>{var t;let s=e.product_id||e.id,n=C.some(e=>e.product_id===s),r=(null===(t=C.find(e=>e.product_id===s))||void 0===t?void 0:t.quantity)||0,i=getAvailableStock(e);return(0,a.jsxs)("div",{className:"border rounded-lg p-3 sm:p-4 hover:bg-gray-50 transition-colors min-w-0 ".concat(n?"border-blue-400 bg-blue-50":"border-gray-200"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 text-sm sm:text-base pr-2 truncate min-w-0 flex-1",children:e.product_name||e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[r>0&&(0,a.jsx)("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:r}),(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-500",children:e.unit})]})]}),(0,a.jsxs)("p",{className:"text-base sm:text-lg font-semibold text-green-600 mb-2 sm:mb-3",children:["₱",(e.price||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center min-w-0",children:[(0,a.jsxs)("span",{className:"text-xs sm:text-sm font-medium ".concat(i>0?"text-green-600":"text-red-600"),children:["Stock: ",i]}),(0,a.jsx)("button",{onClick:()=>addToCart(e),disabled:0===i||n&&r>=i,className:"px-2 sm:px-3 py-1.5 sm:py-2 rounded-md text-xs sm:text-sm font-medium transition-colors flex-shrink-0 ".concat(i>0&&(!n||r<i)?"green"===et?"bg-green-600 text-white hover:bg-green-700":"red"===et?"bg-red-600 text-white hover:bg-red-700":"yellow"===et?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"),children:0===i?"Out":n&&r>=i?"Max":n?"More":"Add"})]})]},s)})})]},t)})})]})}),(0,a.jsx)("div",{className:"hidden lg:block lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 sticky top-8",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Cart (",calculateItemCount()," items)"]}),0===C.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"No items in cart"}),(0,a.jsxs)("button",{onClick:()=>W(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-white rounded-lg transition-colors ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(p.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"View Cart"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-3 mb-6",children:C.map(e=>{let t=getCartItemAvailableStock(e),s=e.quantity>t;return(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 rounded-lg ".concat(s?"bg-red-50 border border-red-200":"bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.product.product_name||e.product.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["₱",(e.product.price||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})," per ",e.product.unit]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("button",{onClick:()=>updateCartQuantity(e.product_id,e.quantity-1),className:"p-1 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(h,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"text-sm w-8 text-center ".concat(s?"text-red-600 font-semibold":"text-gray-600"),children:e.quantity}),(0,a.jsx)("button",{onClick:()=>updateCartQuantity(e.product_id,e.quantity+1),disabled:e.quantity>=t,className:"p-1 text-gray-400 hover:text-gray-600 disabled:text-gray-300",children:(0,a.jsx)(g.Z,{className:"h-3 w-3"})})]}),(0,a.jsxs)("p",{className:"text-xs mt-1 ".concat(s?"text-red-600 font-medium":"text-gray-500"),children:["Max: ",t," | Total: ₱",((e.product.price||0)*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsx)("button",{onClick:()=>removeFromCart(e.product_id),className:"text-red-500 hover:text-red-700 ml-2",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})})]},e.product_id)})}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Type"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"deliveryType",value:"delivery",checked:"delivery"===$,onChange:e=>ee(e.target.value),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Delivery (+₱500)"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"deliveryType",value:"pickup",checked:"pickup"===$,onChange:e=>ee(e.target.value),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Pickup (5% off)"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["₱",calculateSubtotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===$&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),calculateSubtotal()>=1e4?(0,a.jsx)("span",{className:"text-sm text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"+₱500.00"})]}),"pickup"===$&&calculateSubtotal()>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["-₱",(.05*calculateSubtotal()).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===$&&1e4>calculateSubtotal()&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center border-t pt-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600 text-lg",children:["₱",calculateTotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("button",{onClick:()=>W(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-white rounded-lg transition-colors ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(p.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"View Cart"})]})]})]})]})})]}),"products"===A&&!O&&(0,a.jsx)("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-40",children:(0,a.jsxs)("div",{className:"px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2 min-w-0",children:[(0,a.jsxs)("span",{className:"font-medium text-sm truncate",children:["Items: ",calculateItemCount()," • ","delivery"===$?"Delivery":"Pickup"]}),(0,a.jsxs)("span",{className:"font-bold text-base text-green-600 flex-shrink-0 ml-2",children:["₱",calculateTotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("button",{onClick:()=>W(!0),disabled:O,className:"w-full flex items-center justify-center space-x-1 px-2 py-2 rounded-lg transition-colors text-xs sm:text-sm min-w-0 disabled:opacity-50 disabled:cursor-not-allowed ".concat("green"===et?"bg-green-600 hover:bg-green-700 text-white":"red"===et?"bg-red-600 hover:bg-red-700 text-white":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"),children:[(0,a.jsx)(p.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:"View Cart"})]})]})}),"products"===A&&!O&&(0,a.jsx)("div",{className:"lg:hidden pb-20"}),"modify"===A&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2 min-w-0",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-3 sm:p-6",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 truncate",children:"Modify Order - Draft Mode"}),(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6",children:(0,a.jsxs)("p",{className:"text-yellow-800 text-xs sm:text-sm",children:[(0,a.jsx)("strong",{children:"Note:"}),' Changes are saved as draft. Click "Update Order" to save changes permanently.']})}),(0,a.jsx)("div",{className:"space-y-6",children:Object.entries(getProductsByCategory()).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold mb-3 px-4 py-3 border-l-4 rounded-r-md ".concat("green"===et?"border-green-500 bg-green-100 text-green-800":"red"===et?"border-red-500 bg-red-100 text-red-800":"yellow"===et?"border-yellow-500 bg-yellow-100 text-yellow-800":"border-blue-500 bg-blue-100 text-blue-800"),children:t}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:s.map(e=>{var t;let s=e.product_id||e.id,n=C.some(e=>e.product_id===s),r=(null===(t=C.find(e=>e.product_id===s))||void 0===t?void 0:t.quantity)||0,i=getAvailableStock(e);return(0,a.jsxs)("div",{className:"border rounded-lg p-3 sm:p-4 hover:bg-gray-50 transition-colors min-w-0 ".concat(n?"border-blue-400 bg-blue-50":"border-gray-200"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 text-sm sm:text-base pr-2 truncate min-w-0 flex-1",children:e.product_name||e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[r>0&&(0,a.jsx)("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:r}),(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-500",children:e.unit})]})]}),(0,a.jsxs)("p",{className:"text-base sm:text-lg font-semibold text-green-600 mb-2 sm:mb-3",children:["₱",(e.price||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center min-w-0",children:[(0,a.jsxs)("span",{className:"text-xs sm:text-sm font-medium ".concat(i>0?"text-green-600":"text-red-600"),children:["Stock: ",i]}),(0,a.jsx)("button",{onClick:()=>addToCart(e),disabled:0===i||n&&r>=i,className:"px-2 sm:px-3 py-1.5 sm:py-2 rounded-md text-xs sm:text-sm font-medium transition-colors flex-shrink-0 ".concat(i>0&&(!n||r<i)?"green"===et?"bg-green-600 text-white hover:bg-green-700":"red"===et?"bg-red-600 text-white hover:bg-red-700":"yellow"===et?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"),children:0===i?"Out":n&&r>=i?"Max":n?"More":"Add"})]})]},s)})})]},t)})})]})}),(0,a.jsx)("div",{className:"hidden lg:block lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 sticky top-8",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Order Draft (",calculateItemCount()," items)"]}),0===C.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No items in draft"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-3 mb-6",children:C.map(e=>{let t=getCartItemAvailableStock(e),s=e.quantity>t;return(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 rounded-lg ".concat(s?"bg-red-50 border border-red-200":"bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.product.product_name||e.product.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["₱",(e.product.price||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})," per ",e.product.unit]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("button",{onClick:()=>updateCartQuantity(e.product_id,e.quantity-1),className:"p-1 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(h,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"text-sm w-8 text-center ".concat(s?"text-red-600 font-semibold":"text-gray-600"),children:e.quantity}),(0,a.jsx)("button",{onClick:()=>updateCartQuantity(e.product_id,e.quantity+1),disabled:e.quantity>=t,className:"p-1 text-gray-400 hover:text-gray-600 disabled:text-gray-300",children:(0,a.jsx)(g.Z,{className:"h-3 w-3"})})]}),(0,a.jsxs)("p",{className:"text-xs mt-1 ".concat(s?"text-red-600 font-medium":"text-gray-500"),children:["Max: ",t," | Total: ₱",((e.product.price||0)*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsx)("button",{onClick:()=>removeFromCart(e.product_id),className:"text-red-500 hover:text-red-700 ml-2",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})})]},e.product_id)})}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("span",{className:"font-medium",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600 text-lg",children:["₱",calculateTotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("button",{onClick:()=>W(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-white rounded-lg transition-colors ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(u,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"View Changes"})]})]})]})]})})]}),"modify"===A&&(0,a.jsx)("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-40",children:(0,a.jsxs)("div",{className:"px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2 min-w-0",children:[(0,a.jsxs)("span",{className:"font-medium text-sm truncate",children:["Draft: ",calculateItemCount()," items • ","delivery"===$?"Delivery":"Pickup"]}),(0,a.jsxs)("span",{className:"font-bold text-base text-green-600 flex-shrink-0 ml-2",children:["₱",calculateTotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("button",{onClick:()=>W(!0),className:"w-full flex items-center justify-center space-x-1 px-2 py-2 rounded-lg transition-colors text-xs sm:text-sm min-w-0 ".concat("green"===et?"bg-green-600 hover:bg-green-700 text-white":"red"===et?"bg-red-600 hover:bg-red-700 text-white":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"),children:[(0,a.jsx)(u,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:"View Changes"})]})]})}),"modify"===A&&(0,a.jsx)("div",{className:"lg:hidden pb-20"})]}),Q&&(!O||"modify"===A)&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-t-lg sm:rounded-lg w-full max-w-md max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b min-w-0",children:[(0,a.jsxs)("h2",{className:"text-base sm:text-lg font-semibold truncate min-w-0 flex-1",children:["modify"===A?"Order Draft":"Your Cart"," (",calculateItemCount()," items)"]}),(0,a.jsx)("button",{onClick:()=>W(!1),className:"p-2 text-gray-400 hover:text-gray-600 flex-shrink-0",children:(0,a.jsx)(b.Z,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]}),(0,a.jsx)("div",{className:"p-3 sm:p-4 max-h-96 overflow-y-auto",children:0===C.length?(0,a.jsxs)("p",{className:"text-gray-500 text-center py-8",children:["No items in ","modify"===A?"draft":"cart"]}):(0,a.jsx)("div",{className:"space-y-3",children:C.map(e=>{let t=getCartItemAvailableStock(e),s=e.quantity>t;return(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 sm:p-3 rounded-lg min-w-0 ".concat(s?"bg-red-50 border border-red-200":"bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.product.product_name||e.product.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["₱",(e.product.price||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})," per ",e.product.unit]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("button",{onClick:()=>updateCartQuantity(e.product_id,e.quantity-1),className:"p-1 text-gray-400 hover:text-gray-600 flex-shrink-0",children:(0,a.jsx)(h,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"text-sm w-6 sm:w-8 text-center ".concat(s?"text-red-600 font-semibold":"text-gray-600"),children:e.quantity}),(0,a.jsx)("button",{onClick:()=>updateCartQuantity(e.product_id,e.quantity+1),disabled:e.quantity>=t,className:"p-1 text-gray-400 hover:text-gray-600 disabled:text-gray-300 flex-shrink-0",children:(0,a.jsx)(g.Z,{className:"h-3 w-3"})})]}),(0,a.jsxs)("p",{className:"text-xs mt-1 ".concat(s?"text-red-600 font-medium":"text-gray-500"),children:["Max: ",t," | Total: ₱",((e.product.price||0)*e.quantity).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsx)("button",{onClick:()=>removeFromCart(e.product_id),className:"text-red-500 hover:text-red-700 ml-2 flex-shrink-0",children:(0,a.jsx)(b.Z,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]},e.product_id)})})}),C.length>0&&(0,a.jsxs)("div",{className:"p-3 sm:p-4 border-t bg-gray-50",children:[(0,a.jsxs)("div",{className:"mb-3 sm:mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Type"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"deliveryTypeModal",value:"delivery",checked:"delivery"===$,onChange:e=>ee(e.target.value),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Delivery (+₱500)"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"deliveryTypeModal",value:"pickup",checked:"pickup"===$,onChange:e=>ee(e.target.value),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Pickup (5% off)"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-3 sm:mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["₱",calculateSubtotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===$&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Delivery Fee:"}),calculateSubtotal()>=1e4?(0,a.jsx)("span",{className:"text-sm text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"+₱500.00"})]}),"pickup"===$&&calculateSubtotal()>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-sm text-green-600",children:["-₱",(.05*calculateSubtotal()).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===$&&1e4>calculateSubtotal()&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Not available (Order under ₱10k)"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center border-t pt-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm sm:text-base",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600 text-base sm:text-lg flex-shrink-0 ml-2",children:["₱",calculateTotal().toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),Z&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2 sm:p-3 mb-3 sm:mb-4",children:(0,a.jsx)("p",{className:"text-red-800 text-xs sm:text-sm whitespace-pre-line",children:Z})}),(0,a.jsx)("div",{className:"space-y-2",children:"modify"===A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:handleUpdateOrder,disabled:z||0===C.length,className:"w-full flex items-center justify-center space-x-1 sm:space-x-2 px-3 sm:px-4 py-2 sm:py-3 text-white rounded-lg disabled:opacity-50 transition-colors text-sm sm:text-base ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[z?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b-2 border-white flex-shrink-0"}):(0,a.jsx)(u,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:z?"Updating...":"Update Order"})]}),(0,a.jsx)("button",{onClick:()=>{F([]),H("home"),W(!1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors text-sm sm:text-base",children:"Cancel Changes"})]}):(0,a.jsxs)("button",{onClick:handleSubmitOrder,disabled:z||0===C.length,className:"w-full flex items-center justify-center space-x-1 sm:space-x-2 px-3 sm:px-4 py-2 sm:py-3 text-white rounded-lg disabled:opacity-50 transition-colors text-sm sm:text-base ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[z?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b-2 border-white flex-shrink-0"}):(0,a.jsx)(p.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:z?"Submitting...":"Submit Order"})]})})]})]})}),Y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Past Orders"}),(0,a.jsx)("button",{onClick:()=>V(!1),className:"p-2 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(b.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"p-6 max-h-96 overflow-y-auto",children:0===L.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No past orders found"}):(0,a.jsx)("div",{className:"space-y-4",children:L.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Order #",e.id.slice(-8)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[new Date(e.created_at).toLocaleDateString()," at ",new Date(e.created_at).toLocaleTimeString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("released"===e.status?"bg-green-100 text-green-800":"paid"===e.status?"bg-blue-100 text-blue-800":"complete"===e.status?"bg-purple-100 text-purple-800":"bg-red-100 text-red-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:["₱",e.total_amount.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[e.order_details.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{className:"text-gray-900",children:e.products.name}),(0,a.jsxs)("span",{className:"text-gray-600",children:[e.quantity," \xd7 ₱",e.unit_price.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})," = ₱",(e.quantity*e.unit_price).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},e.id)),(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"text-gray-600",children:["₱",getTotalAmount(e).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"delivery"===e.delivery_type&&(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Delivery Fee:"}),getTotalAmount(e)>=1e4?(0,a.jsx)("span",{className:"text-green-600",children:"FREE (Order over ₱10k)"}):(0,a.jsx)("span",{className:"text-gray-600",children:"+₱500.00"})]}),"pickup"===e.delivery_type&&getTotalAmount(e)>=1e4&&(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Pickup Discount (5%):"}),(0,a.jsxs)("span",{className:"text-green-600",children:["-₱",(.05*getTotalAmount(e)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),"pickup"===e.delivery_type&&1e4>getTotalAmount(e)&&(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Pickup Discount:"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Not available (Order under ₱10k)"})]})]})})]}),(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)("button",{onClick:()=>printReceipt(e),className:"flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("green"===et?"bg-green-100 text-green-700 hover:bg-green-200":"red"===et?"bg-red-100 text-red-700 hover:bg-red-200":"yellow"===et?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Print Receipt"})]}),"paid"===e.status&&e.deposit_slip_url&&(0,a.jsx)("a",{href:e.deposit_slip_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:(0,a.jsx)("span",{children:"View Deposit Slip"})})]})})]},e.id))})})]})}),(0,a.jsx)("div",{className:"bg-white border-t py-4 mt-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4",children:(0,a.jsx)("p",{className:"text-center text-xs text-gray-500",children:"\xa9 Gilnaks Food Corporation"})})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full mb-4 ".concat("green"===et?"bg-green-100":"red"===et?"bg-red-100":"yellow"===et?"bg-yellow-100":"bg-blue-100"),children:(0,a.jsx)(i.Z,{className:"h-6 w-6 ".concat("green"===et?"text-green-600":"red"===et?"text-red-600":"yellow"===et?"text-yellow-600":"text-blue-600")})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"GFC Order Portal"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Enter your location passcode to continue"})]}),(0,a.jsxs)("form",{onSubmit:handleLocationAuth,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"passcode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Location Passcode"}),(0,a.jsx)("input",{type:"text",id:"passcode",value:N,onChange:e=>k(e.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 text-center text-lg tracking-wider ".concat("green"===et?"focus:ring-green-500 focus:border-green-500":"red"===et?"focus:ring-red-500 focus:border-red-500":"yellow"===et?"focus:ring-yellow-500 focus:border-yellow-500":"focus:ring-blue-500 focus:border-blue-500"),placeholder:"Enter 6-digit code",maxLength:6,required:!0})]}),Z&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,a.jsx)("p",{className:"text-red-800 text-sm whitespace-pre-line",children:Z})}),(0,a.jsxs)("button",{type:"submit",disabled:z,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-white rounded-lg transition-colors font-medium disabled:opacity-50 ".concat("green"===et?"bg-green-600 hover:bg-green-700":"red"===et?"bg-red-600 hover:bg-red-700":"yellow"===et?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:[z?(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,a.jsx)(i.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:z?"Signing in...":"Continue to Order"})]})]})]})})}},2899:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var a=s(3082);let n=(0,a.createClientComponentClient)()},8939:function(e,t,s){"use strict";s.d(t,{iI:function(){return formatPhilippinesDateTime},sn:function(){return getPhilippinesDate}});let a="Asia/Manila";function toPhilippinesTime(e){let t=new Date(e),s=t.getTime()+6e4*t.getTimezoneOffset(),a=new Date(s+288e5);return a}function getPhilippinesDate(){let e=new Date;return e.toLocaleDateString("en-CA",{timeZone:a})}function formatPhilippinesDateTime(e,t){let s=toPhilippinesTime(e);return s.toLocaleString("en-US",{timeZone:a,...t})}}},function(e){e.O(0,[701,971,472,744],function(){return e(e.s=9033)}),_N_E=e.O()}]);